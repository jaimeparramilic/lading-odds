"use strict";(()=>{var e={};e.id=316,e.ids=[316],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5029:(e,t,r)=>{let n,s,i,o,a,c,l,u,p,d,h;r.r(t),r.d(t,{originalPathname:()=>n4,patchFetch:()=>n3,requestAsyncStorage:()=>n1,routeModule:()=>n0,serverHooks:()=>n5,staticGenerationAsyncStorage:()=>n2});var f,m,y,g,w,b,S,A,v,E,k,T,C,$,P={};r.r(P),r.d(P,{GET:()=>nZ,runtime:()=>nF});var I=r(9303),O=r(8716),R=r(670),_=r(7070);let x=require("crypto");var U=r.n(x);try{n=crypto}catch(e){}function D(e){return e.statusCode>=200&&e.statusCode<=299}!function(e){e.Base64="base64",e.Hex="hex"}(f||(f={}));let N=()=>{throw Error("Missing adapter implementation for 'abstractFetch' - make sure to import the appropriate adapter for your platform")},j=()=>{throw Error("Missing adapter implementation for 'abstractConvertRequest' - make sure to import the appropriate adapter for your platform")},q=()=>Promise.resolve({}),M=()=>{throw Error("Missing adapter implementation for 'abstractConvertResponse' - make sure to import the appropriate adapter for your platform")},H=()=>{throw Error("Missing adapter implementation for 'abstractConvertHeaders' - make sure to import the appropriate adapter for your platform")},L=()=>{throw Error("Missing adapter implementation for 'abstractRuntimeString' - make sure to import the appropriate adapter for your platform")};function F(e){return e.replace(/(^|-)(\w+)/g,(e,t,r)=>t+r.slice(0,1).toUpperCase()+r.slice(1).toLowerCase())}function K(e,t){let r=[];if(!e)return r;let n=F(t);for(let[t,s]of Object.entries(e))F(t)===n&&(Array.isArray(s)?r.push(...s):r.push(s));return r}function J(e,t){if(e)return K(e,t)?.[0]}function W(e,t,r){X(e);let n=F(t),s=e[n];s?Array.isArray(s)||(s=[s]):s=[],e[n]=s,s.push(r)}function V(e){return"number"==typeof e?e.toString():e}function X(e){for(let[t,r]of Object.entries(e)){let n=F(t);e[n]||(e[n]=[]),Array.isArray(e[n])||(e[n]=[V(e[n])]),t!==n&&(delete e[t],e[n].push(...[r].flat().map(e=>V(e))))}return e}async function B(e){let t=e.rawRequest,r={};for(let[e,n]of t.headers.entries())W(r,e,n);return{headers:r,method:t.method??"GET",url:new URL(t.url).toString()}}async function z(e,t){var r;let n=new Headers;return((r=e??{})?Object.entries(r).flatMap(([e,t])=>Array.isArray(t)?t.map(t=>[e,t]):[[e,t]]):[]).forEach(([e,t])=>n.append(e,t)),Promise.resolve(n)}async function G(e,t){return new Response(e.body,{status:e.statusCode,statusText:e.statusText,headers:await z(e.headers??{})})}N=fetch,j=B,M=G,H=z,L=function(){return"Web API"};let Q=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,Y=e=>{if("string"!=typeof e)throw TypeError("Invalid argument expected string");let t=e.match(Q);if(!t)throw Error(`Invalid argument not valid semver ('${e}' received)`);return t.shift(),t},Z=e=>"*"===e||"x"===e||"X"===e,ee=e=>{let t=parseInt(e,10);return isNaN(t)?e:t},et=(e,t)=>typeof e!=typeof t?[String(e),String(t)]:[e,t],er=(e,t)=>{if(Z(e)||Z(t))return 0;let[r,n]=et(ee(e),ee(t));return r>n?1:r<n?-1:0},en=(e,t)=>{for(let r=0;r<Math.max(e.length,t.length);r++){let n=er(e[r]||"0",t[r]||"0");if(0!==n)return n}return 0},es=(e,t)=>{let r=Y(e),n=Y(t),s=r.pop(),i=n.pop(),o=en(r,n);return 0!==o?o:s&&i?en(s.split("."),i.split(".")):s||i?s?-1:1:0},ei=(e,t,r)=>{ec(r);let n=es(e,t);return eo[r].includes(n)},eo={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},ea=Object.keys(eo),ec=e=>{if("string"!=typeof e)throw TypeError(`Invalid operator type, expected string but got ${typeof e}`);if(-1===ea.indexOf(e))throw Error(`Invalid operator, expected one of ${ea.join("|")}`)};(function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Debug=3]="Debug"})(m||(m={})),function(e){e.October22="2022-10",e.January23="2023-01",e.April23="2023-04",e.July23="2023-07",e.October23="2023-10",e.January24="2024-01",e.April24="2024-04",e.July24="2024-07",e.October24="2024-10",e.January25="2025-01",e.April25="2025-04",e.July25="2025-07",e.October25="2025-10",e.Unstable="unstable"}(y||(y={}));let el=y.July25;y.October25,function(e){e.AccessToken="X-Shopify-Access-Token",e.ApiVersion="X-Shopify-API-Version",e.Domain="X-Shopify-Shop-Domain",e.Hmac="X-Shopify-Hmac-Sha256",e.Topic="X-Shopify-Topic",e.SubTopic="X-Shopify-Sub-Topic",e.WebhookId="X-Shopify-Webhook-Id",e.StorefrontPrivateToken="Shopify-Storefront-Private-Token",e.StorefrontSDKVariant="X-SDK-Variant",e.StorefrontSDKVersion="X-SDK-Version"}(g||(g={})),function(e){e.Rest="rest",e.Graphql="graphql"}(w||(w={}));let eu=["CUSTOMERS_DATA_REQUEST","CUSTOMERS_REDACT","SHOP_REDACT"];(function(e){e.OneTime="ONE_TIME",e.Every30Days="EVERY_30_DAYS",e.Annual="ANNUAL",e.Usage="USAGE"})(b||(b={})),function(e){e.ApplyImmediately="APPLY_IMMEDIATELY",e.ApplyOnNextBillingCycle="APPLY_ON_NEXT_BILLING_CYCLE",e.Standard="STANDARD"}(S||(S={}));class ep extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class ed extends ep{}class eh extends ep{}class ef extends ep{}class em extends ep{}class ey extends ep{}class eg extends ep{}class ew extends ep{}class eb extends ep{}class eS extends ep{}class eA extends ep{}class ev extends ep{response;constructor({message:e,code:t,statusText:r,body:n,headers:s}){super(e),this.response={code:t,statusText:r,body:n,headers:s}}}class eE extends ev{}class ek extends eE{}class eT extends eE{constructor({retryAfter:e,...t}){super(t),this.response.retryAfter=e}}class eC extends ep{response;headers;body;constructor({message:e,response:t,headers:r,body:n}){super(e),this.response=t,this.headers=r,this.body=n}}class e$ extends ep{}class eP extends ep{}class eI extends ep{}class eO extends ep{}class eR extends ep{response;constructor({message:e,response:t}){super(e),this.response=t}}class e_ extends eR{}class ex extends ep{}class eU extends ep{}class eD extends ep{errorData;constructor({message:e,errorData:t}){super(e),this.errorData=t}}class eN extends ep{}let ej="11.14.1";function eq(e){let t=function(t,r,n={}){if(t>e.logger.level)return;let s=[];e.logger.timestamps&&s.push(`${new Date().toISOString().slice(0,-5)}Z`);let i=n.package||"shopify-api";switch(delete n.package,t){case m.Debug:i=`${i}/DEBUG`;break;case m.Info:i=`${i}/INFO`;break;case m.Warning:i=`${i}/WARNING`;break;case m.Error:i=`${i}/ERROR`}s.push(i);let o=[];Object.entries(n).forEach(([e,t])=>{o.push(`${e}: ${t}`)});let a="";o.length>0&&(a=` | {${o.join(", ")}}`),e.logger.log(t,`[${s.join("] [")}] ${r}${a}`)};return{log:t,debug:async(e,r={})=>t(m.Debug,e,r),info:async(e,r={})=>t(m.Info,e,r),warning:async(e,r={})=>t(m.Warning,e,r),error:async(e,r={})=>t(m.Error,e,r),deprecated:function(e,r){if(ei(ej,e,">="))throw new eN(`Feature was deprecated in version ${e}`);return t(m.Warning,`[Deprecated | ${e}] ${r}`)}}}class eM{static SCOPE_DELIMITER=",";compressedScopes;expandedScopes;originalScopes;constructor(e){let t=[];"string"==typeof e?t=e.split(RegExp(`${eM.SCOPE_DELIMITER}\\s*`)):Array.isArray(e)?t=e:e&&(t=Array.from(e.expandedScopes)),t=t.map(e=>e.trim()).filter(e=>e.length);let r=this.getImpliedScopes(t),n=new Set(t),s=new Set(r);this.compressedScopes=new Set([...n].filter(e=>!s.has(e))),this.expandedScopes=new Set([...n,...s]),this.originalScopes=n}has(e){return 0===(e instanceof eM?e:new eM(e)).toArray().filter(e=>!this.expandedScopes.has(e)).length}equals(e){let t;return t=e instanceof eM?e:new eM(e),this.compressedScopes.size===t.compressedScopes.size&&0===this.toArray().filter(e=>!t.has(e)).length}toString(){return this.toArray().join(eM.SCOPE_DELIMITER)}toArray(e=!1){return e?[...this.originalScopes]:[...this.compressedScopes]}getImpliedScopes(e){return e.reduce((e,t)=>{let r=t.match(/^(unauthenticated_)?write_(.*)$/);return r&&e.push(`${r[1]?r[1]:""}read_${r[2]}`),e},[])}}function eH(e,t){switch(e){case m.Debug:console.debug(t);break;case m.Info:console.log(t);break;case m.Warning:console.warn(t);break;case m.Error:console.error(t)}}let eL="GraphQL Client",eF="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",eK="Response returned unexpected Content-Type:",eJ="An unknown error has occurred. The API did not return a data object or any errors in its response.",eW={json:"application/json",multipart:"multipart/mixed"},eV="X-SDK-Variant",eX="X-SDK-Version",eB=[429,503],ez=/@(defer)\b/i,eG=/boundary="?([^=";]+)"?/i,eQ="\r\n\r\n";function eY(e,t=eL){return e.startsWith(`${t}`)?e:`${t}: ${e}`}function eZ(e){return e instanceof Error?e.message:JSON.stringify(e)}function e0(e){return e instanceof Error&&e.cause?e.cause:void 0}function e1(e){return e.flatMap(({errors:e})=>e??[])}function e2({client:e,retries:t}){if(void 0!==t&&("number"!=typeof t||t<0||t>3))throw Error(`${e}: The provided "retries" value (${t}) is invalid - it cannot be less than 0 or greater than 3`)}function e5(e,t){return t&&("object"!=typeof t||Array.isArray(t)||"object"==typeof t&&Object.keys(t).length>0)?{[e]:t}:{}}function e4([e,...t]){return t.reduce(function e(t,r){return Object.keys(r||{}).reduce((n,s)=>(("object"==typeof r[s]||Array.isArray(r[s]))&&t[s]?n[s]=e(t[s],r[s]):n[s]=r[s],n),Array.isArray(t)?[...t]:{...t})},{...e})}function e3({clientLogger:e,customFetchApi:t=fetch,client:r=eL,defaultRetryWaitTime:n=1e3,retriableCodes:s=eB}){let i=async(o,a,c)=>{let l;let u=a+1,p=c+1;try{if(l=await t(...o),e({type:"HTTP-Response",content:{requestParams:o,response:l}}),!l.ok&&s.includes(l.status)&&u<=p)throw Error();let r=l?.headers.get("X-Shopify-API-Deprecated-Reason")||"";return r&&e({type:"HTTP-Response-GraphQL-Deprecation-Notice",content:{requestParams:o,deprecationNotice:r}}),l}catch(t){if(u<=p){let t=l?.headers.get("Retry-After");return await e6(t?parseInt(t,10):n),e({type:"HTTP-Retry",content:{requestParams:o,lastResponse:l,retryAttempt:a,maxRetries:c}}),i(o,u,c)}throw Error(eY(`${c>0?`Attempted maximum number of ${c} network retries. Last message - `:""}${eZ(t)}`,r))}};return i}async function e6(e){return new Promise(t=>setTimeout(t,e))}function e8({headers:e,url:t,customFetchApi:r=fetch,retries:n=0,logger:s}){e2({client:eL,retries:n});let i={headers:e,url:t,retries:n},o=function(e,{url:t,headers:r,retries:n}){return async(s,i={})=>{let{variables:o,headers:a,url:c,retries:l,keepalive:u,signal:p}=i,d=JSON.stringify({query:s,variables:o});e2({client:eL,retries:l});let h=Object.entries({...r,...a}).reduce((e,[t,r])=>(e[t]=Array.isArray(r)?r.join(", "):r.toString(),e),{});return h[eV]||h[eX]||(h[eV]="shopify-graphql-client",h[eX]="1.4.1"),e([c??t,{method:"POST",headers:h,body:d,signal:p,keepalive:u}],1,l??n)}}(e3({customFetchApi:r,clientLogger:e=>{s&&s(e)},defaultRetryWaitTime:1e3}),i),a=async(...e)=>{if(ez.test(e[0]))throw Error(eY("This operation will result in a streamable response - use requestStream() instead."));let t=null;try{let{status:r,statusText:n}=t=await o(...e),s=t.headers.get("content-type")||"";if(!t.ok)return{errors:{networkStatusCode:r,message:eY(n),response:t}};if(!s.includes(eW.json))return{errors:{networkStatusCode:r,message:eY(`${eK} ${s}`),response:t}};return await e9(t)}catch(e){return{errors:{message:eZ(e),...null==t?{}:{networkStatusCode:t.status,response:t}}}}},c=async(...e)=>{if(!ez.test(e[0]))throw Error(eY("This operation does not result in a streamable response - use request() instead."));try{let t=await o(...e),{statusText:r}=t;if(!t.ok)throw Error(r,{cause:t});let n=t.headers.get("content-type")||"";switch(!0){case n.includes(eW.json):return{async *[Symbol.asyncIterator](){let e=await e9(t);yield{...e,hasNext:!1}}};case n.includes(eW.multipart):return function(e,t){let r;let n=(t??"").match(eG),s=`--${n?n[1]:"-"}`;if(!e.body?.getReader&&!e.body?.[Symbol.asyncIterator])throw Error("API multipart response did not return an iterable body",{cause:e});let i=e7(e),o={};return{async *[Symbol.asyncIterator](){try{let e=!0;for await(let t of{async *[Symbol.asyncIterator](){try{let e="";for await(let t of i)if((e+=t).indexOf(s)>-1){let t=e.lastIndexOf(s),r=e.slice(0,t).split(s).filter(e=>e.trim().length>0).map(e=>e.slice(e.indexOf(eQ)+eQ.length).trim());r.length>0&&(yield r),e=e.slice(t+s.length),"--"===e.trim()&&(e="")}}catch(e){throw Error(`Error occured while processing stream payload - ${eZ(e)}`)}}}){let n=t.map(e=>{try{return JSON.parse(e)}catch(e){throw Error(`Error in parsing multipart response - ${eZ(e)}`)}}).map(e=>{let{data:t,incremental:r,hasNext:n,extensions:s,errors:i}=e;if(!r)return{data:t||{},...e5("errors",i),...e5("extensions",s),hasNext:n};let o=r.map(({data:e,path:t,errors:r})=>({data:e&&t?function e(t,r){if(0===t.length)return r;let n={[t.pop()]:r};return 0===t.length?n:e(t,n)}(t,e):{},...e5("errors",r)}));return{data:1===o.length?o[0].data:e4([...o.map(({data:e})=>e)]),...e5("errors",e1(o)),hasNext:n}});r=n.find(e=>e.extensions)?.extensions??r;let s=e1(n);o=e4([o,...n.map(({data:e})=>e)]),e=n.slice(-1)[0].hasNext,function(e,t){if(e.length>0)throw Error(eF,{cause:{graphQLErrors:e}});if(0===Object.keys(t).length)throw Error(eJ)}(s,o),yield{...e5("data",o),...e5("extensions",r),hasNext:e}}if(e)throw Error("Response stream terminated unexpectedly")}catch(n){let t=e0(n);yield{...e5("data",o),...e5("extensions",r),errors:{message:eY(eZ(n)),networkStatusCode:e.status,...e5("graphQLErrors",t?.graphQLErrors),response:e},hasNext:!1}}}}}(t,n);default:throw Error(`${eK} ${n}`,{cause:t})}}catch(e){return{async *[Symbol.asyncIterator](){let t=e0(e);yield{errors:{message:eY(eZ(e)),...e5("networkStatusCode",t?.status),...e5("response",t)},hasNext:!1}}}}};return{config:i,fetch:o,request:a,requestStream:c}}async function e9(e){let{errors:t,data:r,extensions:n}=await e.json();return{...e5("data",r),...e5("extensions",n),headers:e.headers,...t||!r?{errors:{networkStatusCode:e.status,message:eY(t?eF:eJ),...e5("graphQLErrors",t),response:e}}:{}}}async function*e7(e){let t=new TextDecoder;if(e.body[Symbol.asyncIterator])for await(let r of e.body)yield t.decode(r);else{let r;let n=e.body.getReader();try{for(;!(r=await n.read()).done;)yield t.decode(r.value)}finally{n.cancel()}}}function te({client:e,storeDomain:t}){try{if(!t||"string"!=typeof t)throw Error();let e=t.trim(),r=e.match(/^https?:/)?e:`https://${e}`,n=new URL(r);return n.protocol="https",n.origin}catch(r){throw Error(`${e}: a valid store domain ("${t}") must be provided`,{cause:r})}}function tt({client:e,currentSupportedApiVersions:t,apiVersion:r,logger:n}){let s=`${e}: the provided apiVersion ("${r}")`,i=`Currently supported API versions: ${t.join(", ")}`;if(!r||"string"!=typeof r)throw Error(`${s} is invalid. ${i}`);let o=r.trim();t.includes(o)||(n?n({type:"Unsupported_Api_Version",content:{apiVersion:r,supportedApiVersions:t}}):console.warn(`${s} is likely deprecated or not supported. ${i}`))}function tr(e){let t=3*e-2;return 10===t?t:`0${t}`}function tn(e,t,r){let n=t-r;return n<=0?`${e-1}-${tr(n+4)}`:`${e}-${tr(n)}`}function ts(){let{year:e,quarter:t,version:r}=function(){let e=new Date,t=e.getUTCMonth(),r=e.getUTCFullYear(),n=Math.floor(t/3+1);return{year:r,quarter:n,version:`${r}-${tr(n)}`}}(),n=4===t?`${e+1}-01`:`${e}-${tr(t+1)}`;return[tn(e,t,3),tn(e,t,2),tn(e,t,1),r,n,"unstable"]}function ti(e){return t=>({...t??{},...e.headers})}function to({getHeaders:e,getApiUrl:t}){return(r,n)=>{let s=[r];if(n&&Object.keys(n).length>0){let{variables:r,apiVersion:i,headers:o,retries:a,signal:c}=n;s.push({...r?{variables:r}:{},...o?{headers:e(o)}:{},...i?{url:t(i)}:{},...a?{retries:a}:{},...c?{signal:c}:{}})}return s}}let ta="application/json",tc="1.1.1",tl="X-Shopify-Access-Token",tu="Admin API Client",tp=[429,500,503];function td(e){if(!e)throw Error(`${tu}: an access token must be provided`)}function th(e=!1){if("undefined"!=typeof window&&!e)throw Error(`${tu}: this client should not be used in the browser`)}function tf(e){let t={};for(let[r,n]of Object.entries(e))t[r.toLowerCase()]=Array.isArray(n)?n.join(", "):String(n);return t}function tm(e){let t=`Shopify API Library v${ej} | ${L()}`;return e.userAgentPrefix&&(t=`${e.userAgentPrefix} | ${t}`),t}function ty(e){if(!e)return{error:"No response object provided"};try{let{status:t,statusText:r,ok:n,redirected:s,type:i,url:o,headers:a}=e,c={status:t,statusText:r,ok:n,redirected:s,type:i,url:o};return a?.entries?c.headers=Object.fromEntries(a.entries()):a&&(c.headers=a),c}catch{return e}}function tg(e){return t=>{if(e.logger.httpRequests)switch(t.type){case"HTTP-Response":{let r=t.content;eq(e).debug("Received response for HTTP request",{requestParams:JSON.stringify(r.requestParams),response:JSON.stringify(ty(r.response))});break}case"HTTP-Retry":{let r=t.content;eq(e).debug("Retrying HTTP request",{requestParams:JSON.stringify(r.requestParams),retryAttempt:r.retryAttempt,maxRetries:r.maxRetries,response:r.lastResponse?JSON.stringify(ty(r.lastResponse)):"undefined"});break}case"HTTP-Response-GraphQL-Deprecation-Notice":{let r=t.content;eq(e).debug("Received response containing Deprecated GraphQL Notice",{requestParams:JSON.stringify(r.requestParams),deprecationNotice:r.deprecationNotice});break}default:eq(e).debug(`HTTP request event: ${t.content}`)}}}function tw(e,t,r){if(void 0===r){let t=e?.errors?.message??"";throw new eS(`Http request error, no response available: ${t}`)}let n=X(Object.fromEntries(r.headers.entries()??[]));if(r.status===i.Ok&&e.errors.graphQLErrors)throw new eC({message:e.errors.graphQLErrors?.[0].message??"GraphQL operation failed",response:r,headers:n,body:e});let s=[];e.errors&&s.push(JSON.stringify(e.errors,null,2));let o=J(n,"x-request-id");o&&s.push(`If you report this error, please include this id: ${o}`);let a=s.length?`:
${s.join("\n")}`:"",c=r.status,l=r.statusText;switch(!0){case r.status===i.TooManyRequests:if(t)throw new eA("Attempted the maximum number of retries for HTTP request.");{let t=J(n,"Retry-After");throw new eT({message:`Shopify is throttling requests ${a}`,code:c,statusText:l,body:e,headers:n,retryAfter:t?parseFloat(t):void 0})}case r.status>=i.InternalServerError:if(t)throw new eA("Attempted the maximum number of retries for HTTP request.");throw new ek({message:`Shopify internal error${a}`,code:c,statusText:l,body:e,headers:n});default:throw new ev({message:`Received an error response (${r.status} ${r.statusText}) from Shopify${a}`,code:c,statusText:l,body:e,headers:n})}}(function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"})(A||(A={})),function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Patch="PATCH",e.Delete="DELETE",e.Head="HEAD",e.Options="OPTIONS",e.Connect="CONNECT"}(s||(s={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported"}(i||(i={})),function(e){e.Accept="Accept",e.AcceptEncoding="Accept-Encoding",e.AcceptLanguage="Accept-Language",e.AccessControlAllowCredentials="Access-Control-Allow-Credentials",e.AccessControlAllowHeaders="Access-Control-Allow-Headers",e.AccessControlAllowMethods="Access-Control-Allow-Methods",e.AccessControlAllowOrigin="Access-Control-Allow-Origin",e.AccessControlExposeHeaders="Access-Control-Expose-Headers",e.AccessControlMaxAge="Access-Control-Max-Age",e.AccessControlRequestHeaders="Access-Control-Request-Headers",e.AccessControlRequestMethod="Access-Control-Request-Method",e.Authorization="Authorization",e.CacheControl="Cache-Control",e.CacheStatus="Cache-Status",e.Connection="Connection",e.ContentDisposition="Content-Disposition",e.ContentEncoding="Content-Encoding",e.ContentLength="Content-Length",e.ContentSecurityPolicy="Content-Security-Policy",e.ContentSecurityPolicyReportOnly="Content-Security-Policy-Report-Only",e.ContentType="Content-Type",e.ContentTypeOptions="X-Content-Type-Options",e.Cookie="Cookie",e.DownloadOptions="X-Download-Options",e.ETag="ETag",e.Forwarded="Forwarded",e.ForwardedFor="X-Forwarded-For",e.ForwardedHost="X-Forwarded-Host",e.ForwardedProtocol="X-Forwarded-Proto",e.FrameOptions="X-Frame-Options",e.Host="Host",e.IfNoneMatch="If-None-Match",e.Location="Location",e.Origin="Origin",e.ReferrerPolicy="Referrer-Policy",e.ServerTiming="Server-Timing",e.StrictTransportSecurity="Strict-Transport-Security",e.TimingAllowOrigin="Timing-Allow-Origin",e.Trailer="Trailer",e.TransferEncoding="Transfer-Encoding",e.UserAgent="User-Agent",e.WwwAuthenticate="WWW-Authenticate",e.XhrRedirectedTo="X-XHR-Redirected-To",e.XhrReferer="X-XHR-Referer",e.XssProtecton="X-XSS-Protection",e.XContentTypeOptions="X-Content-Type-Options",e.XDownloadOptions="X-Download-Options",e.XForwardedFor="X-Forwarded-For",e.XForwardedHost="X-Forwarded-Host",e.XForwardedProto="X-Forwarded-Proto",e.XFrameOptions="X-Frame-Options",e.XXhrRedirectedTo="X-XHR-Redirected-To",e.XXhrReferer="X-XHR-Referer",e.XXssProtecton="X-XSS-Protection",e.XXssProtection="X-XSS-Protection"}(o||(o={})),function(e){e.ChildSrc="child-src",e.ConnectSrc="connect-src",e.DefaultSrc="default-src",e.FontSrc="font-src",e.FrameSrc="frame-src",e.ImgSrc="img-src",e.ManifestSrc="manifest-src",e.MediaSrc="media-src",e.ObjectSrc="object-src",e.PrefetchSrc="prefetch-src",e.ScriptSrc="script-src",e.StyleSrc="style-src",e.WebrtcSrc="webrtc-src",e.WorkerSrc="worker-src",e.BaseUri="base-uri",e.PluginTypes="plugin-types",e.Sandbox="sandbox",e.FormAction="form-action",e.FrameAncestors="frame-ancestors",e.ReportUri="report-uri",e.BlockAllMixedContent="block-all-mixed-content",e.RequireSriFor="require-sri-for",e.UpgradeInsecureRequests="upgrade-insecure-requests"}(a||(a={})),function(e){e.Forms="allow-forms",e.SameOrigin="allow-same-origin",e.Scripts="allow-scripts",e.Popups="allow-popups",e.Modals="allow-modals",e.OrientationLock="allow-orientation-lock",e.PointerLock="allow-pointer-lock",e.Presentation="allow-presentation",e.PopupsToEscapeSandbox="allow-popups-to-escape-sandbox",e.TopNavigation="allow-top-navigation"}(c||(c={})),function(e){e.Any="*",e.Self="'self'",e.UnsafeInline="'unsafe-inline'",e.UnsafeEval="'unsafe-eval'",e.None="'none'",e.StrictDynamic="'strict-dynamic'",e.ReportSample="'report-sample'",e.Data="data:",e.Blob="blob:",e.FileSystem="filesystem:"}(l||(l={})),function(e){e.Script="script",e.Style="style"}(u||(u={})),function(e){e.Sha256="sha256",e.Sha384="sha384",e.Sha512="sha512"}(p||(p={})),function(e){e.Informational="1xx",e.Success="2xx",e.Redirection="3xx",e.ClientError="4xx",e.ServerError="5xx",e.Unknown="Unknown"}(d||(d={})),function(e){e.NoCache="no-cache",e.NoStore="no-store",e.MustRevalidate="must-revalidate",e.MaxAge="max-age"}(h||(h={}));class tb{static config;session;client;apiVersion;constructor(e){let t=this.graphqlClass().config;if(!t.isCustomStoreApp&&!e.session.accessToken)throw new ex("Missing access token when creating GraphQL client");if(e.apiVersion){let r=e.apiVersion===t.apiVersion?`Admin client has a redundant API version override to the default ${e.apiVersion}`:`Admin client overriding default API version ${t.apiVersion} with ${e.apiVersion}`;eq(t).debug(r)}this.session=e.session,this.apiVersion=e.apiVersion,this.client=function({storeDomain:e,apiVersion:t,accessToken:r,userAgentPrefix:n,retries:s=0,customFetchApi:i,logger:o,isTesting:a}){var c;let l=ts(),u=te({client:tu,storeDomain:e});th(a),tt({client:tu,currentSupportedApiVersions:l,apiVersion:t,logger:o}),td(r);let p=(c={client:tu,currentSupportedApiVersions:l,logger:o},e=>{e&&tt({...c,apiVersion:e});let r=(e??t).trim();return`${u}/admin/api/${r}/graphql.json`}),d={storeDomain:u,apiVersion:t,accessToken:r,headers:{"Content-Type":ta,Accept:ta,[tl]:r,"User-Agent":`${n?`${n} | `:""}${tu} v${tc}`},apiUrl:p(),userAgentPrefix:n},h=e8({headers:d.headers,url:d.apiUrl,retries:s,customFetchApi:i,logger:o}),f=ti(d),m=e=>e?p(e):d.apiUrl,y=to({getHeaders:f,getApiUrl:m});return Object.freeze({config:d,getHeaders:f,getApiUrl:m,fetch:(...e)=>h.fetch(...y(...e)),request:(...e)=>h.request(...y(...e))})}({accessToken:t.adminApiAccessToken??this.session.accessToken,apiVersion:this.apiVersion??t.apiVersion,storeDomain:this.session.shop,customFetchApi:N,logger:tg(t),userAgentPrefix:tm(t),isTesting:t.isTesting})}async query(e){let t,r;if(eq(this.graphqlClass().config).deprecated("12.0.0","The query method is deprecated, and was replaced with the request method.\nSee the migration guide: https://github.com/Shopify/shopify-app-js/blob/main/packages/apps/shopify-api/docs/migrating-to-v9.md#using-the-new-clients."),"string"==typeof e.data&&0===e.data.length||0===Object.entries(e.data).length)throw new ex("Query missing.");"string"==typeof e.data?t=e.data:(t=e.data.query,r=e.data.variables);let n=Object.fromEntries(Object.entries(e?.extraHeaders??{}).map(([e,t])=>[e,Array.isArray(t)?t.join(", "):t.toString()]));return{body:await this.request(t,{headers:n,retries:e.tries?e.tries-1:void 0,variables:r}),headers:{}}}async request(e,t){let r=await this.client.request(e,{apiVersion:this.apiVersion||this.graphqlClass().config.apiVersion,...t});if(r.errors){let e=r.errors.response;tw(r,(t?.retries??0)>0,e)}let n=Object.fromEntries(r.headers?r.headers.entries():[]);return{...r,headers:X(n??{})}}graphqlClass(){return this.constructor}}function tS({config:e}){class t extends tb{static config=e}return Reflect.defineProperty(t,"name",{value:"GraphqlClient"}),t}async function tA(e,t,r=f.Base64){let s=void 0===n?.webcrypto?n:n.webcrypto,i=new TextEncoder,o=await s.subtle.importKey("raw",i.encode(e),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),a=await s.subtle.sign("HMAC",o,i.encode(t));return r===f.Base64?tk(a):tv(a)}function tv(e){return[...new Uint8Array(e)].map(e=>e.toString(16).padStart(2,"0")).join("")}let tE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function tk(e){let t="",r=new Uint8Array(e);for(let e=0;e<r.length;){let n=r[e++],s=r[e++],i=r[e++],o=n>>2,a=(3&n)<<4|s>>4,c=(15&s)<<2|i>>6,l=63&i;isNaN(s)&&(c=64),isNaN(i)&&(l=64),t+=tE[o]+tE[a]+tE[c]+tE[l]}return t}class tT{static config;static formatPaths;static LINK_HEADER_REGEXP=/<([^<]+)>; rel="([^"]+)"/;static DEFAULT_LIMIT="50";static RETRY_WAIT_TIME=1e3;static DEPRECATION_ALERT_DELAY=3e5;loggedDeprecations={};client;session;apiVersion;constructor({session:e,apiVersion:t}){let r=this.restClass().config;if(!r.isCustomStoreApp&&!e.accessToken)throw new ex("Missing access token when creating REST client");if(t){let e=t===r.apiVersion?`REST client has a redundant API version override to the default ${t}`:`REST client overriding default API version ${r.apiVersion} with ${t}`;eq(r).debug(e)}let n=r.adminApiAccessToken??r.apiSecretKey;this.session=e,this.apiVersion=t??r.apiVersion,this.client=function({storeDomain:e,apiVersion:t,accessToken:r,userAgentPrefix:n,logger:s,customFetchApi:i=fetch,retries:o=0,scheme:a="https",defaultRetryTime:c=1e3,formatPaths:l=!0,isTesting:u}){let p=ts(),d=te({client:tu,storeDomain:e}).replace("https://",`${a}://`);th(u),tt({client:tu,currentSupportedApiVersions:p,apiVersion:t,logger:s}),td(r),e2({client:tu,retries:o});let h=function(e,t,r,n=!0){return(s,i,o)=>{o&&tt({...r,apiVersion:o});let a=(o??t).trim(),c=s.replace(/^\//,"");n&&(c.startsWith("admin")||(c=`admin/api/${a}/${c}`),c.endsWith(".json")||(c=`${c}.json`));let l=new URLSearchParams;if(i)for(let[e,t]of Object.entries(i))!function e(t,r,n){if(Array.isArray(n)){n.forEach(n=>e(t,`${r}[]`,n));return}if("object"==typeof n){Object.entries(n).forEach(([n,s])=>e(t,`${r}[${n}]`,s));return}t.append(r,String(n))}(l,e,t);let u=l.toString()?`?${l.toString()}`:"";return`${e}/${c}${u}`}}(d,t,{client:tu,currentSupportedApiVersions:p,logger:s},l),f=e3({customFetchApi:i,clientLogger:e=>{s&&s(e)},defaultRetryWaitTime:c,client:tu,retriableCodes:tp}),m=async(e,{method:t,data:s,headers:i,searchParams:a,retries:c=0,apiVersion:l})=>{e2({client:tu,retries:c});let u=h(e,a??{},l),p=tf(i??{}),d=[...p["user-agent"]?[p["user-agent"]]:[],...n?[n]:[],`${tu} v${tc}`].join(" | "),m=tf({"Content-Type":ta,...p,Accept:ta,[tl]:r,"User-Agent":d}),y=s&&"string"!=typeof s?JSON.stringify(s):s;return f([u,{method:t,headers:m,...y?{body:y}:void 0}],1,c??o)};return{get:(e,t)=>m(e,{method:A.Get,...t}),put:(e,t)=>m(e,{method:A.Put,...t}),post:(e,t)=>m(e,{method:A.Post,...t}),delete:(e,t)=>m(e,{method:A.Delete,...t})}}({scheme:r.hostScheme,storeDomain:e.shop,apiVersion:t??r.apiVersion,accessToken:r.isCustomStoreApp?n:e.accessToken,customFetchApi:N,logger:tg(r),userAgentPrefix:tm(r),defaultRetryTime:this.restClass().RETRY_WAIT_TIME,formatPaths:this.restClass().formatPaths,isTesting:r.isTesting})}async get(e){return this.request({method:s.Get,...e})}async post(e){return this.request({method:s.Post,...e})}async put(e){return this.request({method:s.Put,...e})}async delete(e){return this.request({method:s.Delete,...e})}async request(e){let t;let r={headers:{...e.extraHeaders,...e.type?{"Content-Type":e.type.toString()}:{}},retries:e.tries?e.tries-1:void 0,searchParams:e.query};switch(e.method){case s.Get:t=await this.client.get(e.path,r);break;case s.Put:t=await this.client.put(e.path,{...r,data:e.data});break;case s.Post:t=await this.client.post(e.path,{...r,data:e.data});break;case s.Delete:t=await this.client.delete(e.path,r);break;default:throw new eU(`Unsupported request method '${e.method}'`)}let n=await t.text(),i=e.method===s.Delete&&""===n?{}:JSON.parse(n),o=X(Object.fromEntries(t.headers.entries()));t.ok||tw(i,(e.tries??1)>1,t);let a={body:i,headers:o};await this.logDeprecations({method:e.method,url:e.path,headers:r.headers,body:e.data?JSON.stringify(e.data):void 0},a);let c=t.headers.get("Link");if(void 0!==c){let t={limit:e.query?.limit?e.query?.limit.toString():tT.DEFAULT_LIMIT};if(c)for(let e of c.split(", ")){let r=e.match(tT.LINK_HEADER_REGEXP);if(!r)continue;let n=r[2],s=new URL(r[1]),i=s.searchParams.get("fields"),o=s.searchParams.get("page_info");if(!t.fields&&i&&(t.fields=i.split(",")),o)switch(n){case"previous":t.previousPageUrl=r[1],t.prevPage=this.buildRequestParams(r[1]);break;case"next":t.nextPageUrl=r[1],t.nextPage=this.buildRequestParams(r[1])}}a.pageInfo=t}return a}restClass(){return this.constructor}buildRequestParams(e){let t=new URL(e);return{path:t.pathname.replace(RegExp("^/admin/api/[^/]+/(.*).json$"),"$1"),query:Object.fromEntries(t.searchParams.entries())}}async logDeprecations(e,t){let r=this.restClass().config,n=J(t.headers,"X-Shopify-API-Deprecated-Reason");if(n){let t={message:n,path:e.url};e.body&&(t.body=`${e.body.substring(0,100)}...`);let s=await tA(r.apiSecretKey,JSON.stringify(t),f.Hex);if(!Object.keys(this.loggedDeprecations).includes(s)||Date.now()-this.loggedDeprecations[s]>=tT.DEPRECATION_ALERT_DELAY){this.loggedDeprecations[s]=Date.now();let e=Error().stack,n=`API Deprecation Notice ${new Date().toLocaleString()} : ${JSON.stringify(t)}  -  Stack Trace: ${e}`;await eq(r).warning(n)}}}}function tC(e){let{config:t,formatPaths:r}=e;class n extends tT{static config=t;static formatPaths=void 0===r||r}return Reflect.defineProperty(n,"name",{value:"RestClient"}),n}let t$="application/json",tP="Storefront API Client";class tI{static config;session;client;apiVersion;constructor(e){let t;let r=this.storefrontClass().config;if(!r.isCustomStoreApp&&!e.session.accessToken)throw new ex("Missing access token when creating GraphQL client");if(e.apiVersion){let t=e.apiVersion===r.apiVersion?`Storefront client has a redundant API version override to the default ${e.apiVersion}`:`Storefront client overriding default API version ${r.apiVersion} with ${e.apiVersion}`;eq(r).debug(t)}if(r.isCustomStoreApp){if(!(t=r.privateAppStorefrontAccessToken))throw new ex("Custom store apps must set the privateAppStorefrontAccessToken property to call the Storefront API.")}else if(!(t=e.session.accessToken))throw new ex("Session missing access token.");this.session=e.session,this.apiVersion=e.apiVersion,this.client=function({storeDomain:e,apiVersion:t,publicAccessToken:r,privateAccessToken:n,clientName:s,retries:i=0,customFetchApi:o,logger:a}){let c=ts(),l=te({client:tP,storeDomain:e}),u={client:tP,currentSupportedApiVersions:c,logger:a};tt({...u,apiVersion:t}),function(e,t){if(!e&&!t)throw Error(`${tP}: a public or private access token must be provided`);if(e&&t)throw Error(`${tP}: only provide either a public or private access token`)}(r,n),function(e){if(e&&"undefined"!=typeof window)throw Error(`${tP}: private access tokens and headers should only be used in a server-to-server implementation. Use the public API access token in nonserver environments.`)}(n);let p=e=>{e&&tt({...u,apiVersion:e});let r=(e??t).trim();return`${l}/api/${r}/graphql.json`},d={storeDomain:l,apiVersion:t,...r?{publicAccessToken:r}:{privateAccessToken:n},headers:{"Content-Type":t$,Accept:t$,"X-SDK-Variant":"storefront-api-client","X-SDK-Version":"1.0.9",...s?{"X-SDK-Variant-Source":s}:{},...r?{"X-Shopify-Storefront-Access-Token":r}:{"Shopify-Storefront-Private-Token":n}},apiUrl:p(),clientName:s},h=e8({headers:d.headers,url:d.apiUrl,retries:i,customFetchApi:o,logger:a}),f=ti(d),m=e=>e?p(e):d.apiUrl,y=to({getHeaders:f,getApiUrl:m});return Object.freeze({config:d,getHeaders:f,getApiUrl:m,fetch:(...e)=>h.fetch(...y(...e)),request:(...e)=>h.request(...y(...e)),requestStream:(...e)=>h.requestStream(...y(...e))})}({privateAccessToken:t,apiVersion:this.apiVersion??r.apiVersion,storeDomain:this.session.shop,customFetchApi:N,logger:tg(r),clientName:tm(r)})}async query(e){let t,r;if(eq(this.storefrontClass().config).deprecated("12.0.0","The query method is deprecated, and was replaced with the request method.\nSee the migration guide: https://github.com/Shopify/shopify-app-js/blob/main/packages/apps/shopify-api/docs/migrating-to-v9.md#using-the-new-clients."),"string"==typeof e.data&&0===e.data.length||0===Object.entries(e.data).length)throw new ex("Query missing.");"string"==typeof e.data?t=e.data:(t=e.data.query,r=e.data.variables);let n=Object.fromEntries(Object.entries(e?.extraHeaders??{}).map(([e,t])=>[e,Array.isArray(t)?t.join(", "):t.toString()]));return{body:await this.request(t,{headers:n,retries:e.tries?e.tries-1:void 0,variables:r}),headers:{}}}async request(e,t){let r=await this.client.request(e,{apiVersion:this.apiVersion||this.storefrontClass().config.apiVersion,...t});if(r.errors){let e=r.errors.response;tw(r,(t?.retries??0)>0,e)}return r}storefrontClass(){return this.constructor}}var tO=/bot|crawl|http|lighthouse|scan|search|spider/i;function tR(e){return!!e&&(function(){if(v instanceof RegExp)return v;try{v=RegExp(" daum[ /]| deusu/|(?:^|[^g])news(?!sapphire)|(?<! (?:channel/|google/))google(?!(app|/google| pixel))|(?<! cu)bots?(?:\\b|_)|(?<!(?:lib))http|(?<![hg]m)score|(?<!cam)scan|@[a-z][\\w-]+\\.|\\(\\)|\\.com\\b|\\btime/|\\||^<|^[\\w \\.\\-\\(?:\\):%]+(?:/v?\\d+(?:\\.\\d+)?(?:\\.\\d{1,10})*?)?(?:,|$)|^[^ ]{50,}$|^\\d+\\b|^\\w*search\\b|^\\w+/[\\w\\(\\)]*$|^active|^ad muncher|^amaya|^avsdevicesdk/|^azure|^biglotron|^bot|^bw/|^clamav[ /]|^client/|^cobweb/|^custom|^ddg[_-]android|^discourse|^dispatch/\\d|^downcast/|^duckduckgo|^email|^facebook|^getright/|^gozilla/|^hobbit|^hotzonu|^hwcdn/|^igetter/|^jeode/|^jetty/|^jigsaw|^microsoft bits|^movabletype|^mozilla/\\d\\.\\d\\s[\\w\\.-]+$|^mozilla/\\d\\.\\d\\s\\(compatible;?(?:\\s\\w+\\/\\d+\\.\\d+)?\\)$|^navermailapp|^netsurf|^offline|^openai/|^owler|^php|^postman|^python|^rank|^read|^reed|^rest|^rss|^snapchat|^space bison|^svn|^swcd |^taringa|^thumbor/|^track|^w3c|^webbandit/|^webcopier|^wget|^whatsapp|^wordpress|^xenu link sleuth|^yahoo|^yandex|^zdm/\\d|^zoom marketplace/|agent|analyzer|archive|ask jeeves/teoma|audit|bit\\.ly/|bluecoat drtr|browsex|burpcollaborator|capture|catch|check\\b|checker|chrome-lighthouse|chromeframe|classifier|cloudflare|convertify|crawl|cypress/|dareboost|datanyze|dejaclick|detect|dmbrowser|download|evc-batch/|exaleadcloudview|feed|fetcher|firephp|functionize|grab|headless|httrack|hubspot marketing grader|hydra|ibisbrowser|infrawatch|insight|inspect|iplabel|java(?!;)|library|linkcheck|mail\\.ru/|manager|measure|neustar wpm|node|nutch|offbyone|onetrust|optimize|pageburst|pagespeed|parser|perl|phantomjs|pingdom|powermarks|preview|proxy|ptst[ /]\\d|retriever|rexx;|rigor|rss\\b|scrape|server|sogou|sparkler/|speedcurve|spider|splash|statuscake|supercleaner|synapse|synthetic|tools|torrent|transcoder|url|validator|virtuoso|wappalyzer|webglance|webkit2png|whatcms/|xtate/","i")}catch(e){v=tO}return v})().test(e)}class t_{static stringify(e){return e&&0!==Object.keys(e).length?new t_().putAll(e).stringify():""}processedQuery;constructor(){this.processedQuery=new URLSearchParams}putAll(e){return Object.entries(e).forEach(([e,t])=>this.put(e,t)),this}put(e,t){Array.isArray(t)?this.putArray(e,t):t?.constructor===Object?this.putObject(e,t):this.putSimple(e,t)}putArray(e,t){t.forEach(t=>this.processedQuery.append(`${e}[]`,`${t}`))}putObject(e,t){Object.entries(t).forEach(([t,r])=>{this.processedQuery.append(`${e}[${t}]`,`${r}`)})}putSimple(e,t){this.processedQuery.append(e,`${t}`)}stringify(e=!1){let t=this.processedQuery.toString();return e?t:`?${t}`}}let tx=(e,t)=>{if(typeof e==typeof t){let r=new TextEncoder,n=r.encode(JSON.stringify(e)),s=r.encode(JSON.stringify(t));if(n.length===s.length)return function(e,t){let r=new Uint8Array(e),n=new Uint8Array(t),s=0;for(let e=0;e<r.length;e++)s|=r[e]^n[e];return 0===s}(n,s)}else throw new ew(`Mismatched data types provided: ${typeof e} and ${typeof t}`);return!1};!function(e){e.Flow="flow",e.Webhook="webhook",e.FulfillmentService="fulfillment_service"}(E||(E={}));let tU={MissingBody:"missing_body",InvalidHmac:"invalid_hmac",MissingHmac:"missing_hmac"};function tD(e){return async(t,{signator:r}={signator:"admin"})=>{if("admin"===r&&!t.hmac)throw new ed("Query does not contain an HMAC value.");if("appProxy"===r&&!t.signature)throw new ed("Query does not contain a signature value.");return function(e){if(Math.abs(Math.trunc(Date.now()/1e3)-Number(e.timestamp))>90)throw new ed("HMAC timestamp is outside of the tolerance range")}(t),tx("appProxy"===r?t.signature:t.hmac,await (async(t,r="admin")=>{let{hmac:n,signature:s,...i}=t,o="admin"===r?function(e){let t=new t_;return Object.keys(e).sort((e,t)=>e.localeCompare(t)).forEach(r=>t.put(r,e[r])),t.stringify(!0)}(i):Object.entries(i).sort(([e],[t])=>e.localeCompare(t)).reduce((e,[t,r])=>`${e}${t}=${Array.isArray(r)?r.join(","):r}`,"");return tA(e.apiSecretKey,o,f.Hex)})(t,r))}}async function tN(e,t,r,n){return tx(r,await tA(e.apiSecretKey,t,n))}function tj(e){return async function({type:t,rawBody:r,...n}){let s=await j(n);if(!r.length)return tq(tU.MissingBody,t,e);let i=J(s.headers,g.Hmac);return i?await tN(e,r,i,f.Base64)?tM(t,e):tq(tU.InvalidHmac,t,e):tq(tU.MissingHmac,t,e)}}async function tq(e,t,r){let n=eq(r);return await n.debug(`${t} request is not valid`,{reason:e}),{valid:!1,reason:e}}async function tM(e,t){let r=eq(t);return await r.debug(`${e} request is valid`),{valid:!0}}function tH(e){let t=tF(e);if("admin"!==t.split(".")[0])return null;let r=RegExp("admin\\..+/store/([^/]+)"),n=t.match(r);if(!n||2!==n.length)return null;{let e=n[1],r=t.includes("spin.dev/store/"),s=t.includes("shop.dev/store/");return r?function(e){let t=RegExp("admin\\.web\\.(.+\\.spin\\.dev)/store/(.+)"),r=e.match(t);if(!r||3!==r.length)return null;{let e=r[1],t=r[2];return`${t}.shopify.${e}`}}(t):s?function(e){let t=RegExp("admin\\.shop\\.dev/store/(.+)"),r=e.match(t);if(!r||2!==r.length)return null;{let e=r[1];return`${e}.shop.dev`}}(t):`${e}.myshopify.com`}}function tL(e){let t=tF(e),r=RegExp("(.+)\\.myshopify\\.com$"),n=t.match(r);if(n&&2===n.length){let e=n[1];return`admin.shopify.com/store/${e}`}{let e=t.endsWith("spin.dev"),r=t.endsWith("shop.dev");return e?function(e){let t=RegExp("(.+)\\.shopify\\.(.+\\.spin\\.dev)"),r=e.match(t);if(!r||3!==r.length)return null;{let e=r[1],t=r[2];return`admin.web.${t}/store/${e}`}}(t):r?function(e){let t=RegExp("(.+)\\.shop\\.dev$"),r=e.match(t);if(!r||2!==r.length)return null;{let e=r[1];return`admin.shop.dev/store/${e}`}}(t):null}}function tF(e){return e.replace(/^https?:\/\//,"").replace(/\/$/,"")}function tK(e){return(t,r=!1)=>{let n=t,s=["myshopify\\.com","shopify\\.com","myshopify\\.io","shop\\.dev"];e.customShopDomains&&s.push(...e.customShopDomains.map(e=>"string"==typeof e?e:e.source));let i=RegExp(`^[a-zA-Z0-9][a-zA-Z0-9-_]*\\.(${s.join("|")})[/]*$`);RegExp(`^admin\\.(${s.join("|")})/store/([a-zA-Z0-9][a-zA-Z0-9-_]*)$`).test(n)&&(n=tH(n)||"");let o=i.test(n)?n:null;if(!o&&r)throw new eh("Received invalid shop argument");return o}}function tJ(){return(e,t=!1)=>{let r=/^[0-9a-zA-Z+/]+={0,2}$/.test(e)?e:null;if(r){let{hostname:e}=new URL(`https://${atob(r)}`);RegExp("\\.(myshopify\\.com|shopify\\.com|myshopify\\.io|spin\\.dev|shop\\.dev)$").test(e)||(r=null)}if(!r&&t)throw new ef("Received invalid host argument");return r}}function tW(e){return async function(t,r){let n=eq(e),s=e.logger.httpRequests&&e.logger.level===m.Debug;s&&n.debug("Making HTTP request",{method:r?.method||"GET",url:t,...r?.body&&{body:r?.body}});let i=await N(t,r);return s&&n.debug("HTTP request completed",{method:r?.method||"GET",url:t,status:i.status}),i}}!function(e){e.JSON="application/json",e.GraphQL="application/graphql",e.URLEncoded="application/x-www-form-urlencoded"}(k||(k={}));let tV="shopify_app_session",tX="shopify_app_state";function tB(){return n.getRandomValues(new Uint8Array(15)).map(e=>e%10).join("")}let tz={randomUUID:x.randomUUID},tG=new Uint8Array(256),tQ=tG.length,tY=[];for(let e=0;e<256;++e)tY.push((e+256).toString(16).slice(1));let tZ=function(e,t,r){if(tz.randomUUID&&!t&&!e)return tz.randomUUID();let n=(e=e||{}).random??e.rng?.()??(tQ>tG.length-16&&((0,x.randomFillSync)(tG),tQ=0),tG.slice(tQ,tQ+=16));if(n.length<16)throw Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return(tY[e[t+0]]+tY[e[t+1]]+tY[e[t+2]]+tY[e[t+3]]+"-"+tY[e[t+4]]+tY[e[t+5]]+"-"+tY[e[t+6]]+tY[e[t+7]]+"-"+tY[e[t+8]]+tY[e[t+9]]+"-"+tY[e[t+10]]+tY[e[t+11]]+tY[e[t+12]]+tY[e[t+13]]+tY[e[t+14]]+tY[e[t+15]]).toLowerCase()}(n)},t0=["id","shop","state","isOnline","scope","accessToken","expires","onlineAccessInfo"];class t1{static fromPropertyArray(e,t=!1){if(!Array.isArray(e))throw new eO("The parameter is not an array: a Session cannot be created from this object.");let r=Object.fromEntries(e.filter(([e,t])=>null!=t).map(([e,t])=>{switch(e.toLowerCase()){case"isonline":return["isOnline",t];case"accesstoken":return["accessToken",t];case"onlineaccessinfo":return["onlineAccessInfo",t];case"userid":return["userId",t];case"firstname":return["firstName",t];case"lastname":return["lastName",t];case"accountowner":return["accountOwner",t];case"emailverified":return["emailVerified",t];default:return[e.toLowerCase(),t]}})),n={},s={associated_user:{}};return Object.entries(r).forEach(([e,r])=>{switch(e){case"isOnline":"string"==typeof r?n[e]="true"===r.toString().toLowerCase():"number"==typeof r?n[e]=!!r:n[e]=r;break;case"scope":n[e]=r.toString();break;case"expires":n[e]=r?new Date(Number(r)):void 0;break;case"onlineAccessInfo":s.associated_user.id=Number(r);break;case"userId":if(t){s.associated_user.id=Number(r);break}case"firstName":if(t){s.associated_user.first_name=String(r);break}case"lastName":if(t){s.associated_user.last_name=String(r);break}case"email":if(t){s.associated_user.email=String(r);break}case"accountOwner":if(t){s.associated_user.account_owner=!!r;break}case"locale":if(t){s.associated_user.locale=String(r);break}case"collaborator":if(t){s.associated_user.collaborator=!!r;break}case"emailVerified":if(t){s.associated_user.email_verified=!!r;break}default:n[e]=r}}),n.isOnline&&(n.onlineAccessInfo=s),new t1(n)}id;shop;state;isOnline;scope;expires;accessToken;onlineAccessInfo;constructor(e){Object.assign(this,e)}isActive(e,t=500){let r=!!this.accessToken,n=!this.isExpired(t);return!this.isScopeChanged(e)&&r&&n}isScopeChanged(e){return void 0!==e&&!this.isScopeIncluded(e)}isScopeIncluded(e){let t=e instanceof eM?e:new eM(e);return new eM(this.scope).has(t)}isExpired(e=0){return!!(this.expires&&this.expires.getTime()-e<Date.now())}toObject(){let e={id:this.id,shop:this.shop,state:this.state,isOnline:this.isOnline};return this.scope&&(e.scope=this.scope),this.expires&&(e.expires=this.expires),this.accessToken&&(e.accessToken=this.accessToken),this.onlineAccessInfo&&(e.onlineAccessInfo=this.onlineAccessInfo),e}equals(e){if(!e||!(this.id===e.id&&this.shop===e.shop&&this.state===e.state&&this.isOnline===e.isOnline))return!1;let t=this.toPropertyArray(!0);t.sort(([e],[t])=>e<t?-1:1);let r=e.toPropertyArray(!0);return r.sort(([e],[t])=>e<t?-1:1),JSON.stringify(t)===JSON.stringify(r)}toPropertyArray(e=!1){return Object.entries(this).filter(([e,t])=>t0.includes(e)&&null!=t).flatMap(([t,r])=>{switch(t){case"expires":return[[t,r?r.getTime():void 0]];case"onlineAccessInfo":if(!e)return[[t,r.associated_user.id]];return[["userId",r?.associated_user?.id],["firstName",r?.associated_user?.first_name],["lastName",r?.associated_user?.last_name],["email",r?.associated_user?.email],["locale",r?.associated_user?.locale],["emailVerified",r?.associated_user?.email_verified],["accountOwner",r?.associated_user?.account_owner],["collaborator",r?.associated_user?.collaborator]];default:return[[t,r]]}}).filter(([e,t])=>void 0!==t)}}let t2=require("node:buffer"),t5=new TextEncoder,t4=new TextDecoder,t3=e=>new Uint8Array(t2.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=t4.decode(t)),t}(e),"base64url")),t6=require("node:crypto"),t8=require("node:util");class t9 extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class t7 extends t9{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class re extends t9{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class rt extends t9{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class rr extends t9{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class rn extends t9{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class rs extends t9{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class ri extends t9{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class ro extends t9{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function ra(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new rr(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let rc=t6.webcrypto,rl=e=>t8.types.isCryptoKey(e),ru=e=>t8.types.isKeyObject(e);function rp(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let rd=(e,...t)=>rp("Key must be ",e,...t);function rh(e,t,...r){return rp(`Key for the ${e} algorithm must be `,t,...r)}let rf=e=>ru(e)||rl(e),rm=["KeyObject"];function ry(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function rg(e){return ry(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||rc?.CryptoKey)&&rm.push("CryptoKey"),new WeakMap;let rw=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new rr("Unsupported key curve for this operation")}},rb=(e,t)=>{let r;if(rl(e))r=t6.KeyObject.from(e);else if(ru(e))r=e;else if(rg(e))return e.crv;else throw TypeError(rd(e,...rm));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return rw(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}},rS=(e,t)=>{let r;try{r=e instanceof t6.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},rA=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function rv(e,t){let r,n,s,i;if(t instanceof t6.KeyObject)r=t.asymmetricKeyType,n=t.asymmetricKeyDetails;else switch(s=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");rS(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:s}=n,i=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${i}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==s&&s>i>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");rS(t,e),i={padding:t6.constants.RSA_PKCS1_PSS_PADDING,saltLength:t6.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let n=rb(t),s=rA.get(e);if(n!==s)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${s}, got ${n}`);i={dsaEncoding:"ieee-p1363"};break}default:throw new rr(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return s?{format:"jwk",key:t,...i}:i?{...i,key:t}:t}function rE(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function rk(e,t){return e.name===t}function rT(e){return parseInt(e.name.slice(4),10)}function rC(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(rd(t,...rm));return(0,t6.createSecretKey)(t)}if(t instanceof t6.KeyObject)return t;if(rl(t))return function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!rk(e.algorithm,"HMAC"))throw rE("HMAC");let r=parseInt(t.slice(2),10);if(rT(e.algorithm.hash)!==r)throw rE(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!rk(e.algorithm,"RSASSA-PKCS1-v1_5"))throw rE("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(rT(e.algorithm.hash)!==r)throw rE(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!rk(e.algorithm,"RSA-PSS"))throw rE("RSA-PSS");let r=parseInt(t.slice(2),10);if(rT(e.algorithm.hash)!==r)throw rE(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw rE("Ed25519 or Ed448");break;case"Ed25519":if(!rk(e.algorithm,"Ed25519"))throw rE("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!rk(e.algorithm,"ECDSA"))throw rE("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw rE(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}(function(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}})(e,r)}(t,e,r),t6.KeyObject.from(t);if(rg(t))return e.startsWith("HS")?(0,t6.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(rd(t,...rm,"Uint8Array","JSON Web Key"))}let r$=(0,t8.promisify)(t6.sign),rP=async(e,t,r)=>{let n=rC(e,t,"sign");if(e.startsWith("HS")){let t=t6.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new rr(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),n);return t.update(r),t.digest()}return r$(ra(e),r,rv(e,n))},rI=(0,t8.promisify)(t6.verify),rO=async(e,t,r,n)=>{let s=rC(e,t,"verify");if(e.startsWith("HS")){let t=await rP(e,s,n);try{return t6.timingSafeEqual(r,t)}catch{return!1}}let i=ra(e),o=rv(e,s);try{return await rI(i,n,o,r)}catch{return!1}},rR=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},r_=e=>e?.[Symbol.toStringTag],rx=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},rU=(e,t,r,n)=>{if(!(t instanceof Uint8Array)){if(n&&rg(t)){if(function(e){return rg(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&rx(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!rf(t))throw TypeError(rh(e,t,...rm,"Uint8Array",n?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${r_(t)} instances for symmetric algorithms must be of type "secret"`)}},rD=(e,t,r,n)=>{if(n&&rg(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&rx(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&rx(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!rf(t))throw TypeError(rh(e,t,...rm,n?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${r_(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${r_(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${r_(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${r_(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${r_(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function rN(e,t,r,n){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?rU(t,r,n,e):rD(t,r,n,e)}rN.bind(void 0,!1);let rj=rN.bind(void 0,!0),rq=function(e,t,r,n,s){let i;if(void 0!==s.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let o of(i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!i.has(o))throw new rr(`Extension Header Parameter "${o}" is not recognized`);if(void 0===s[o])throw new e(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&void 0===n[o])throw new e(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(n.crit)},rM=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)},rH=e=>e.d?(0,t6.createPrivateKey)({format:"jwk",key:e}):(0,t6.createPublicKey)({format:"jwk",key:e});async function rL(e,t){if(!ry(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return t3(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new rr('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return rH({...e,alg:t});default:throw new rr('Unsupported "kty" (Key Type) Parameter value')}}async function rF(e,t,r){let n,s;if(!ry(e))throw new rn("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new rn('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new rn("JWS Protected Header incorrect type");if(void 0===e.payload)throw new rn("JWS Payload missing");if("string"!=typeof e.signature)throw new rn("JWS Signature missing or incorrect type");if(void 0!==e.header&&!ry(e.header))throw new rn("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=t3(e.protected);i=JSON.parse(t4.decode(t))}catch{throw new rn("JWS Protected Header is invalid")}if(!rR(i,e.header))throw new rn("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...i,...e.header},a=rq(rn,new Map([["b64",!0]]),r?.crit,i,o),c=!0;if(a.has("b64")&&"boolean"!=typeof(c=i.b64))throw new rn('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:l}=o;if("string"!=typeof l||!l)throw new rn('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&rM("algorithms",r.algorithms);if(u&&!u.has(l))throw new rt('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new rn("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new rn("JWS Payload must be a string or an Uint8Array instance");let p=!1;"function"==typeof t?(t=await t(i,e),p=!0,rj(l,t,"verify"),rg(t)&&(t=await rL(t,l))):rj(l,t,"verify");let d=function(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}(t5.encode(e.protected??""),t5.encode("."),"string"==typeof e.payload?t5.encode(e.payload):e.payload);try{n=t3(e.signature)}catch{throw new rn("Failed to base64url decode the signature")}if(!await rO(l,t,n,d))throw new ro;if(c)try{s=t3(e.payload)}catch{throw new rn("Failed to base64url decode the payload")}else s="string"==typeof e.payload?t5.encode(e.payload):e.payload;let h={payload:s};return(void 0!==e.protected&&(h.protectedHeader=i),void 0!==e.header&&(h.unprotectedHeader=e.header),p)?{...h,key:t}:h}async function rK(e,t,r){if(e instanceof Uint8Array&&(e=t4.decode(e)),"string"!=typeof e)throw new rn("Compact JWS must be a string or Uint8Array");let{0:n,1:s,2:i,length:o}=e.split(".");if(3!==o)throw new rn("Invalid Compact JWS");let a=await rF({payload:s,protected:n,signature:i},t,r),c={payload:a.payload,protectedHeader:a.protectedHeader};return"function"==typeof t?{...c,key:a.key}:c}let rJ=e=>Math.floor(e.getTime()/1e3),rW=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,rV=e=>{let t;let r=rW.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(31557600*n)}return"-"===r[1]||"ago"===r[4]?-t:t},rX=e=>e.toLowerCase().replace(/^application\//,""),rB=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),rz=(e,t,r={})=>{let n,s;try{n=JSON.parse(t4.decode(t))}catch{}if(!ry(n))throw new rs("JWT Claims Set must be a top-level JSON object");let{typ:i}=r;if(i&&("string"!=typeof e.typ||rX(e.typ)!==rX(i)))throw new t7('unexpected "typ" JWT header value',n,"typ","check_failed");let{requiredClaims:o=[],issuer:a,subject:c,audience:l,maxTokenAge:u}=r,p=[...o];for(let e of(void 0!==u&&p.push("iat"),void 0!==l&&p.push("aud"),void 0!==c&&p.push("sub"),void 0!==a&&p.push("iss"),new Set(p.reverse())))if(!(e in n))throw new t7(`missing required "${e}" claim`,n,e,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(n.iss))throw new t7('unexpected "iss" claim value',n,"iss","check_failed");if(c&&n.sub!==c)throw new t7('unexpected "sub" claim value',n,"sub","check_failed");if(l&&!rB(n.aud,"string"==typeof l?[l]:l))throw new t7('unexpected "aud" claim value',n,"aud","check_failed");switch(typeof r.clockTolerance){case"string":s=rV(r.clockTolerance);break;case"number":s=r.clockTolerance;break;case"undefined":s=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:d}=r,h=rJ(d||new Date);if((void 0!==n.iat||u)&&"number"!=typeof n.iat)throw new t7('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new t7('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>h+s)throw new t7('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new t7('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=h-s)throw new re('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){let e=h-n.iat;if(e-s>("number"==typeof u?u:rV(u)))throw new re('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-s)throw new t7('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function rG(e,t,r){let n=await rK(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new rs("JWTs MUST NOT use unencoded payload");let s={payload:rz(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...s,key:n.key}:s}function rQ(e){return async(t,{checkAudience:r=!0}={})=>{let n;try{n=(await rG(t,function(e){let t=new Uint8Array(e.length);for(let r=0,n=e.length;r<n;r++)t[r]=e.charCodeAt(r);return t}(e.apiSecretKey),{algorithms:["HS256"],clockTolerance:10})).payload}catch(e){throw new em(`Failed to parse session token '${t}': ${e.message}`)}if(r&&n.aud!==e.apiKey)throw new em("Session token had invalid API key");return n}}function rY(e,t,r){let n=e.split(t),s=Math.min(Math.abs(r),n.length);return[...n.slice(0,s-1),n.slice(s-1).join(t)]}class rZ{response;static parseCookies(e){let t=Object.fromEntries(e.filter(e=>e.trim().length>0).map(e=>{let[t,...r]=e.split(";"),[n,s]=rY(t,"=",2).map(e=>e.trim());return[n,{name:n,value:s,...Object.fromEntries(r.map(e=>rY(e,"=",2).map(e=>e.trim())))}]}));for(let e of Object.values(t))"string"==typeof e.expires&&(e.expires=new Date(e.expires));return t}static encodeCookie(e){let t="";return t+=`${e.name}=${e.value};`+Object.entries(e).filter(([e])=>!["name","value","expires"].includes(e)).map(([e,t])=>`${e}=${t}`).join("; "),e.expires&&(t+=`;expires=${e.expires.toUTCString()}`),t}receivedCookieJar={};outgoingCookieJar={};keys=[];constructor(e,t,{keys:r=[]}={}){this.response=t,r&&(this.keys=r);let n=J(e.headers,"Cookie")??"";this.receivedCookieJar=rZ.parseCookies(n.split(";"));let s=K(t.headers,"Set-Cookie")??[];this.outgoingCookieJar=rZ.parseCookies(s)}toHeaders(){return Object.values(this.outgoingCookieJar).map(e=>rZ.encodeCookie(e))}updateHeader(){this.response.headers||(this.response.headers={}),function(e,t){X(e);let r=F(t);delete e[r]}(this.response.headers,"Set-Cookie"),this.toHeaders().map(e=>W(this.response.headers,"Set-Cookie",e))}get(e){return this.receivedCookieJar[e]?.value}deleteCookie(e){this.set(e,"",{path:"/",expires:new Date(0)})}async getAndVerify(e){let t=this.get(e);if(t){if(!await this.isSignedCookieValid(e))return;return t}}get canSign(){return this.keys?.length>0}set(e,t,r={}){this.outgoingCookieJar[e]={...r,name:e,value:t},this.updateHeader()}async setAndSign(e,t,r={}){if(!this.canSign)throw Error("No keys provided for signing.");this.set(e,t,r);let n=`${e}.sig`,s=await tA(this.keys[0],t);this.set(n,s,r),this.updateHeader()}async isSignedCookieValid(e){let t=`${e}.sig`;if(!this.cookieExists(e)||!this.cookieExists(t))return this.deleteInvalidCookies(e,t),!1;let r=this.get(e),n=this.get(t);return!!(r&&n&&(await Promise.all(this.keys.map(e=>tA(e,r)))).includes(n))||(this.deleteInvalidCookies(e,t),!1)}cookieExists(e){return!!this.get(e)}deleteInvalidCookies(...e){e.forEach(e=>this.deleteCookie(e))}}function r0(e){return(t,r)=>`${tK(e)(t,!0)}_${r}`}function r1(e){return t=>`offline_${tK(e)(t,!0)}`}function r2({config:e,accessTokenResponse:t,shop:r,state:n}){let s=!!t.associated_user;eq(e).info("Creating new session",{shop:r,isOnline:s});let i=e=>new Date(Date.now()+1e3*e);return new t1({shop:r,state:n,isOnline:s,accessToken:t.access_token,scope:t.scope,...s?(t=>{let{access_token:n,scope:s,...o}=t;return{id:e.isEmbeddedApp?r0(e)(r,`${o.associated_user.id}`):tZ(),onlineAccessInfo:o,expires:i(o.expires_in)}})(t):(t=>{let{expires_in:n}=t;return{id:r1(e)(r),...n&&{expires:i(n)}}})(t)})}let r5=({request:e,log:t,func:r})=>{t.debug(`Possible bot request to auth ${r}: `,{userAgent:e.headers["User-Agent"]})};async function r4({config:e,query:t,stateFromCookie:r}){return await tD(e)(t)&&tx(t.state,r)}function r3(e,t){if(e)throw new eb(t)}function r6(e){return t=>{tJ()(t,!0);let r=atob(t);return`https://${r}/apps/${e.apiKey}`}}function r8(e){return(t,r=e.apiVersion)=>{if(r===y.Unstable)return!0;let n=e=>parseInt(e.replace("-",""),10);return n(r)>=n(t)}}(function(e){e.OnlineAccessToken="urn:shopify:params:oauth:token-type:online-access-token",e.OfflineAccessToken="urn:shopify:params:oauth:token-type:offline-access-token"})(T||(T={})),function(e){e.Http="http",e.EventBridge="eventbridge",e.PubSub="pubsub"}(C||(C={})),function(e){e.Create="create",e.Update="update",e.Delete="delete"}($||($={}));let r9={...tU,MissingHeaders:"missing_headers"};function r7(e){return e.toUpperCase().replace(/\/|\./g,"_")}function ne(e){return function(t){return e[r7(t)]||[]}}function nt(e,t){let r=t.deliveryMethod;switch(t.deliveryMethod){case C.Http:return`${r}_${nr(e,t.callbackUrl)}`;case C.EventBridge:return`${r}_${t.arn}`;case C.PubSub:return`${r}_${t.pubSubProject}:${t.pubSubTopic}`;default:throw new eg(`Unrecognized delivery method '${t.deliveryMethod}'`)}}function nr(e,t){return t.startsWith("/")?`${e.hostScheme}://${e.hostName}${t}`:t}function nn(e,t,r,n){let s=eq(e);if(n.includeFields?.sort(),n.metafieldNamespaces?.sort(),!(r in t)){t[r]=[n];return}let i=nt(e,n);for(let o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&i===nt(e,t[r][o])){if(n.deliveryMethod===C.Http){s.info(`Detected multiple handlers for '${r}', webhooks.process will call them sequentially`);break}throw new eg(`Can only add multiple handlers for a topic when deliveryMethod is Http. Please be sure that you used addHandler method once after creating ShopifyApi instance in your app.  Invalid handler: ${JSON.stringify(n)}`)}t[r].push(n)}function ns(e,t){let r=e;return Object.entries(t).forEach(([e,t])=>{r=r.replace(`{{${e}}}`,t)}),r}async function ni(e,t){let r;let n=new(tS({config:e}))({session:t}),s={},i=null;do{let e=ns(nd,{END_CURSOR:JSON.stringify(i)}),t=await n.request(e);t.data?.webhookSubscriptions?.edges.forEach(e=>{let t=function(e){let t;let r=e.node.endpoint;switch(r.__typename){case"WebhookHttpEndpoint":t={deliveryMethod:C.Http,callbackUrl:r.callbackUrl,callback:async()=>{}};break;case"WebhookEventBridgeEndpoint":t={deliveryMethod:C.EventBridge,arn:r.arn};break;case"WebhookPubSubEndpoint":t={deliveryMethod:C.PubSub,pubSubProject:r.pubSubProject,pubSubTopic:r.pubSubTopic}}return t.id=e.node.id,t.includeFields=e.node.includeFields,t.metafieldNamespaces=e.node.metafieldNamespaces,t.includeFields?.sort(),t.metafieldNamespaces?.sort(),t}(e);s[e.node.topic]||(s[e.node.topic]=[]),s[e.node.topic].push(t)}),i=t.data?.webhookSubscriptions?.pageInfo.endCursor,r=t.data?.webhookSubscriptions?.pageInfo.hasNextPage}while(r);return s}async function no({config:e,session:t,topic:r,existingHandlers:n,handlers:s}){let i=[],{toCreate:o,toUpdate:a,toDelete:c}=function(e,t,r){let n=r.reduce((t,r)=>(t[nt(e,r)]=r,t),{}),s=t.reduce((t,r)=>(t[nt(e,r)]=r,t),{}),i={...n},o={},a={};for(let e in s){if(!Object.prototype.hasOwnProperty.call(s,e))continue;let t=s[e],r=n[e];e in n?(delete i[e],!function(e,t){let r=na(e.includeFields||[],t.includeFields||[]),n=na(e.metafieldNamespaces||[],t.metafieldNamespaces||[]);return r&&n}(t,r)&&(o[e]=r,o[e].id=t.id)):a[e]=t}return{toCreate:Object.values(i),toUpdate:Object.values(o),toDelete:Object.values(a)}}(e,n,s),l=new(tS({config:e}))({session:t}),u=$.Create;return i=i.concat(await nc({config:e,client:l,topic:r,operation:u,handlers:o})),u=$.Update,i=i.concat(await nc({config:e,client:l,topic:r,operation:u,handlers:a})),u=$.Delete,i=i.concat(await nc({config:e,client:l,topic:r,operation:u,handlers:c}))}function na(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}async function nc({config:e,client:t,topic:r,handlers:n,operation:s}){let i=[];for(let o of n)i.push(await nl({config:e,client:t,topic:r,handler:o,operation:s}));return i}async function nl({config:e,client:t,topic:r,handler:n,operation:s}){let i;eq(e).debug("Running webhook mutation",{topic:r,operation:s});try{let o=function(e,t,r,n){let s;let i={};s=r.id?`id: "${r.id}"`:`topic: ${t}`;let o={MUTATION_NAME:nu(r,n),IDENTIFIER:s,MUTATION_PARAMS:""};if(n!==$.Delete){switch(r.deliveryMethod){case C.Http:i.callbackUrl=`"${nr(e,r.callbackUrl)}"`;break;case C.EventBridge:i.arn=`"${r.arn}"`;break;case C.PubSub:i.pubSubProject=`"${r.pubSubProject}"`,i.pubSubTopic=`"${r.pubSubTopic}"`;break;default:throw new eg(`Unrecognized delivery method '${r.deliveryMethod}'`)}if(r.includeFields&&(i.includeFields=JSON.stringify(r.includeFields)),r.metafieldNamespaces&&(i.metafieldNamespaces=JSON.stringify(r.metafieldNamespaces)),r.subTopic){let e=`subTopic: "${r.subTopic}",`;o.MUTATION_PARAMS=e}let t=Object.entries(i).map(([e,t])=>`${e}: ${t}`).join(", ");o.MUTATION_PARAMS+=`webhookSubscription: {${t}}`}return ns(nh,o)}(e,r,n,s),a=await t.request(o);i={deliveryMethod:n.deliveryMethod,success:function(e,t,r){let n=nu(t,r);return!!(e.data&&e.data[n]&&0===e.data[n].userErrors.length)}(a,n,s),result:a,operation:s}}catch(e){if(e instanceof eg)i={deliveryMethod:n.deliveryMethod,success:!1,result:{message:e.message},operation:s};else throw e}return i}function nu(e,t){switch(t){case $.Create:return`${np(e)}Create`;case $.Update:return`${np(e)}Update`;case $.Delete:return"webhookSubscriptionDelete";default:throw new ep(`Unrecognized operation '${t}'`)}}function np(e){switch(e.deliveryMethod){case C.Http:return"webhookSubscription";case C.EventBridge:return"eventBridgeWebhookSubscription";case C.PubSub:return"pubSubWebhookSubscription";default:throw new ep(`Unrecognized delivery method '${e.deliveryMethod}'`)}}let nd=`query shopifyApiReadWebhookSubscriptions {
  webhookSubscriptions(
    first: 250,
    after: {{END_CURSOR}},
  ) {
    edges {
      node {
        id
        topic
        includeFields
        metafieldNamespaces
        endpoint {
          __typename
          ... on WebhookHttpEndpoint {
            callbackUrl
          }
          ... on WebhookEventBridgeEndpoint {
            arn
          }
          ... on WebhookPubSubEndpoint {
            pubSubProject
            pubSubTopic
          }
        }
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}`,nh=`
  mutation shopifyApiCreateWebhookSubscription {
    {{MUTATION_NAME}}(
      {{IDENTIFIER}},
      {{MUTATION_PARAMS}}
    ) {
      userErrors {
        field
        message
      }
    }
  }
`,nf={subTopic:g.SubTopic},nm={apiVersion:g.ApiVersion,domain:g.Domain,hmac:g.Hmac,topic:g.Topic,webhookId:g.WebhookId,...nf};function ny(e){return async function({rawBody:t,...r}){let n=await j(r),s=await tj(e)({type:E.Webhook,rawBody:t,...r});if(!s.valid){if(s.reason===tU.InvalidHmac){let t=eq(e);await t.debug("Webhook HMAC validation failed. Please note that events manually triggered from a store's Notifications settings will fail this validation. To test this, please use the CLI or trigger the actual event in a development store.")}return s}return function(e){let t=[],r=Object.entries(nm).reduce((r,[n,s])=>{let i=J(e,s);return i?r[n]=i:n in nf||t.push(s),r},{});return t.length?{valid:!1,reason:r9.MissingHeaders,missingHeaders:t}:{valid:!0,...r,...r.subTopic?{subTopic:r.subTopic}:{},topic:r7(r.topic)}}(n.headers)}}let ng={[i.Ok]:"OK",[i.BadRequest]:"Bad Request",[i.Unauthorized]:"Unauthorized",[i.NotFound]:"Not Found",[i.InternalServerError]:"Internal Server Error"};async function nw(e,t,r,n,s){let o=eq(e),{hmac:a,valid:c,...l}=r;await o.debug("Webhook request is valid, looking for HTTP handlers to call",l);let u=t[r.topic]||[],p={statusCode:i.Ok},d=!1;for(let e of u)if(e.deliveryMethod===C.Http){if(!e.callback)throw p.statusCode=i.InternalServerError,p.errorMessage="Cannot call webhooks.process with a webhook handler that doesn't have a callback",new e_({message:p.errorMessage,response:p});d=!0,await o.debug("Found HTTP handler, triggering it",l);try{await e.callback(r.topic,r.domain,n,r.webhookId,r.apiVersion,...r?.subTopic?r.subTopic:"",s)}catch(e){p.statusCode=i.InternalServerError,p.errorMessage=e.message}}return d||(await o.debug("No HTTP handlers found",l),p.statusCode=i.NotFound,p.errorMessage=`No HTTP webhooks registered for topic ${r.topic}`),p}async function nb(e,t){let r={statusCode:i.InternalServerError,errorMessage:"Unknown error while handling webhook"};switch(t.reason){case r9.MissingHeaders:r.statusCode=i.BadRequest,r.errorMessage=`Missing one or more of the required HTTP headers to process webhooks: [${t.missingHeaders.join(", ")}]`;break;case r9.MissingBody:r.statusCode=i.BadRequest,r.errorMessage="No body was received when processing webhook";break;case r9.MissingHmac:r.statusCode=i.BadRequest,r.errorMessage="Missing HMAC header in request";break;case r9.InvalidHmac:r.statusCode=i.Unauthorized,r.errorMessage="Could not validate request HMAC"}return await eq(e).debug(`Webhook request is invalid, returning ${r.statusCode}: ${r.errorMessage}`),r}let nS=`
  fragment AppSubscriptionFragment on AppSubscription {
    id
    name
    test
    status
    trialDays
    createdAt
    currentPeriodEnd
    returnUrl
    lineItems {
      id
      plan {
        pricingDetails {
          ... on AppRecurringPricing {
            price {
              amount
              currencyCode
            }
            interval
            discount {
              durationLimitInIntervals
              remainingDurationInIntervals
              priceAfterDiscount {
                amount
              }
              value {
                ... on AppSubscriptionDiscountAmount {
                  amount {
                    amount
                    currencyCode
                  }
                }
                ... on AppSubscriptionDiscountPercentage {
                  percentage
                }
              }
            }
          }
          ... on AppUsagePricing {
            balanceUsed {
              amount
              currencyCode
            }
            cappedAmount {
              amount
              currencyCode
            }
            terms
          }
        }
      }
    }
  }
`;function nA(e){e&&e.price?.amount&&"string"==typeof e.price.amount&&(e.price.amount=parseFloat(e.price.amount))}function nv(e){e&&(e.balanceUsed?.amount&&"string"==typeof e.balanceUsed.amount&&(e.balanceUsed.amount=parseFloat(e.balanceUsed.amount)),e.cappedAmount?.amount&&"string"==typeof e.cappedAmount.amount&&(e.cappedAmount.amount=parseFloat(e.cappedAmount.amount)))}function nE(e){return e.map(e=>{if(e.plan?.pricingDetails){var t;e.plan.pricingDetails=((t=e.plan.pricingDetails)&&(nv(t),nA(t),t&&(t.discount?.priceAfterDiscount?.amount&&"string"==typeof t.discount.priceAfterDiscount.amount&&(t.discount.priceAfterDiscount.amount=parseFloat(t.discount.priceAfterDiscount.amount)),t.discount?.value?.amount?.amount&&"string"==typeof t.discount.value.amount.amount&&(t.discount.value.amount.amount=parseFloat(t.discount.value.amount.amount)))),t)}return e})}async function nk({client:e,isTest:t,plans:r}){let n;let s={hasActivePayment:!1,oneTimePurchases:[],appSubscriptions:[]},i=null;do{let o=await e.request(nT,{variables:{endCursor:i}});(n=o.data?.currentAppInstallation).activeSubscriptions.forEach(e=>{(function({subscription:e,isTest:t,plans:r}){return(void 0===r||r.includes(e.name))&&(t||!e.test)})({subscription:e,isTest:t,plans:r})&&(s.hasActivePayment=!0,e.lineItems&&(e.lineItems=nE(e.lineItems)),s.appSubscriptions.push(e))}),n.oneTimePurchases.edges.forEach(({node:e})=>{(function({purchase:e,isTest:t,plans:r}){return(void 0===r||r.includes(e.name))&&(t||!e.test)&&"ACTIVE"===e.status})({purchase:e,isTest:t,plans:r})&&(s.hasActivePayment=!0,s.oneTimePurchases.push(e))}),i=n.oneTimePurchases.pageInfo.endCursor}while(n?.oneTimePurchases.pageInfo.hasNextPage);return s}let nT=`
  ${nS}
  query appSubscription($endCursor: String) {
    currentAppInstallation {
      activeSubscriptions {
        ...AppSubscriptionFragment
      }
      oneTimePurchases(first: 250, sortKey: CREATED_AT, after: $endCursor) {
        edges {
          node {
            id
            name
            test
            status
          }
        }
        pageInfo {
          hasNextPage
          endCursor
        }
      }
    }
  }
`,nC=`
  ${nS}
  mutation AppSubscriptionCreate(
    $name: String!
    $returnUrl: URL!
    $test: Boolean
    $trialDays: Int
    $replacementBehavior: AppSubscriptionReplacementBehavior
    $lineItems: [AppSubscriptionLineItemInput!]!
  ) {
    appSubscriptionCreate(
      name: $name
      returnUrl: $returnUrl
      test: $test
      trialDays: $trialDays
      replacementBehavior: $replacementBehavior
      lineItems: $lineItems
    ) {
      appSubscription {
        ...AppSubscriptionFragment
      }
      confirmationUrl
      userErrors {
        field
        message
      }
    }
  }
`,n$=`
  mutation test(
    $name: String!
    $price: MoneyInput!
    $returnUrl: URL!
    $test: Boolean
  ) {
    appPurchaseOneTimeCreate(
      name: $name
      price: $price
      returnUrl: $returnUrl
      test: $test
    ) {
      appPurchaseOneTime {
        id
        name
        test
      }
      confirmationUrl
      userErrors {
        field
        message
      }
    }
  }
`;async function nP({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:s}){let i=e.lineItems.map(e=>{if(e.interval===b.Every30Days||e.interval===b.Annual){let t={interval:e.interval,price:{amount:e.amount,currencyCode:e.currencyCode}};return e.discount&&(t.discount={durationLimitInIntervals:e.discount.durationLimitInIntervals,value:{amount:e.discount.value.amount,percentage:e.discount.value.percentage}}),{plan:{appRecurringPricingDetails:t}}}if(e.interval===b.Usage)return{plan:{appUsagePricingDetails:{terms:e.terms,cappedAmount:{amount:e.amount,currencyCode:e.currencyCode}}}};throw new eD({message:"Invalid interval provided",errorData:[e]})}),o=await r.request(nC,{variables:{name:t,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,returnUrl:n,test:s,lineItems:i}});if(o.errors)throw new eD({message:"Error while billing the store",errorData:o.errors});return o.data}async function nI({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:s}){let i=await r.request(nC,{variables:{name:t,returnUrl:n,test:s,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,lineItems:[{plan:{appRecurringPricingDetails:{interval:e.interval,price:{amount:e.amount,currencyCode:e.currencyCode},discount:e.discount?{durationLimitInIntervals:e.discount?.durationLimitInIntervals,value:{amount:e.discount?.value?.amount,percentage:e.discount?.value?.percentage}}:void 0}}}]}});if(i.data?.appSubscriptionCreate?.userErrors.length)throw new eD({message:"Error while creating a subscription",errorData:i.data?.appSubscriptionCreate?.userErrors});return i.data}async function nO({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:s}){let i=await r.request(nC,{variables:{name:t,returnUrl:n,test:s,trialDays:e.trialDays,replacementBehavior:e.replacementBehavior,lineItems:[{plan:{appUsagePricingDetails:{terms:e.usageTerms,cappedAmount:{amount:e.amount,currencyCode:e.currencyCode}}}}]}});if(i.data?.appSubscriptionCreate?.userErrors.length)throw new eD({message:"Error while creating a subscription",errorData:i.data?.appSubscriptionCreate?.userErrors});return i.data}async function nR({billingConfig:e,plan:t,client:r,returnUrl:n,isTest:s}){let i=await r.request(n$,{variables:{name:t,returnUrl:n,test:s,price:{amount:e.amount,currencyCode:e.currencyCode}}});if(i.errors)throw new eD({message:"Error while billing the store",errorData:i.errors});return i.data}let n_=`
  ${nS}
  mutation appSubscriptionCancel($id: ID!, $prorate: Boolean) {
    appSubscriptionCancel(id: $id, prorate: $prorate) {
      appSubscription {
        ...AppSubscriptionFragment
      }
      userErrors {
        field
        message
      }
    }
  }
`,nx=`
${nS}
query appSubscription {
  currentAppInstallation {
    activeSubscriptions {
      ...AppSubscriptionFragment
    }
  }
}
`,nU=`
mutation appUsageRecordCreate($description: String!, $price: MoneyInput!, $subscriptionLineItemId: ID!) {
  appUsageRecordCreate(description: $description, price: $price, subscriptionLineItemId: $subscriptionLineItemId) {
    userErrors {
      field
      message
    }
    appUsageRecord {
      id
      description
      idempotencyKey
      price {
        amount
        currencyCode
      }
      subscriptionLineItem {
        id
        plan {
          pricingDetails {
            ... on AppUsagePricing {
              balanceUsed {
                amount
                currencyCode
              }
              cappedAmount {
                amount
                currencyCode
              }
              terms
            }
          }
        }
      }
    }
  }
}
`;async function nD({client:e,isTest:t}){let r=await nk({client:e,isTest:t});if(!r.hasActivePayment)throw new eD({message:"No active payment found",errorData:[]});if(!r.appSubscriptions.length)throw new eD({message:"No active subscriptions found",errorData:[]});if(r.appSubscriptions)return function(e){for(let t of e)if("ACTIVE"===t.status&&t.lineItems){for(let e of t.lineItems)if("balanceUsed"in e.plan.pricingDetails)return e.id}throw new eD({message:"No active usage subscription found",errorData:[]})}(r.appSubscriptions);throw new eD({message:"Unable to find active subscription line item",errorData:[]})}let nN=`
${nS}
mutation appSubscriptionLineItemUpdate($cappedAmount: MoneyInput!, $id: ID!) {
  appSubscriptionLineItemUpdate(cappedAmount: $cappedAmount, id: $id) {
    userErrors {
      field
      message
    }
    confirmationUrl
    appSubscription {
      ...AppSubscriptionFragment
    }
  }
}
`,nj=(process.env.APP_URL||"").replace(/\/+$/,""),nq=process.env.SHOPIFY_API_KEY||"",nM=(process.env.SHOPIFY_API_SECRET||"").replace(/\r?\n/g,"").trim(),nH=(process.env.SHOPIFY_SCOPES||"").split(",").map(e=>e.trim()).filter(Boolean);if(!nj||!nq||!nM||0===nH.length)throw Error("Faltan envs: APP_URL / SHOPIFY_API_KEY / SHOPIFY_API_SECRET / SHOPIFY_SCOPES");let nL=function({future:e,restResources:t,...r}){var n;let s=function(e){let t;let r={apiKey:"",apiSecretKey:"",hostName:"",hostScheme:"https",apiVersion:el,isEmbeddedApp:!0,isCustomStoreApp:!1,logger:{log:eH,level:m.Info,httpRequests:!1,timestamps:!1},future:{},_logDisabledFutureFlags:!0},n=["apiSecretKey","hostName"];"isCustomStoreApp"in e&&e.isCustomStoreApp||n.push("apiKey"),"isCustomStoreApp"in e&&e.isCustomStoreApp&&(!("adminApiAccessToken"in e)||e.adminApiAccessToken?.length===0)&&n.push("adminApiAccessToken");let s=[];if(n.forEach(t=>{var r;null!=(r=e[t])&&(!("string"==typeof r||Array.isArray(r))||r.length>0)||s.push(t)}),s.length)throw new ep(`Cannot initialize Shopify API Library. Missing values for: ${s.join(", ")}`);let i=e.future?.v10_lineItemBilling?{lineItemBilling:e.future?.v10_lineItemBilling,...e.future}:e.future,{hostScheme:o,isCustomStoreApp:a,adminApiAccessToken:c,userAgentPrefix:l,logger:u,privateAppStorefrontAccessToken:p,customShopDomains:d,billing:h,...f}=e;return t=void 0===e.scopes?void 0:e.scopes instanceof eM?e.scopes:new eM(e.scopes),Object.assign(r,f,{hostName:e.hostName.replace(/\/$/,""),scopes:t,hostScheme:o??r.hostScheme,isCustomStoreApp:a??r.isCustomStoreApp,adminApiAccessToken:c??r.adminApiAccessToken,userAgentPrefix:l??r.userAgentPrefix,logger:{...r.logger,...u||{}},privateAppStorefrontAccessToken:p??r.privateAppStorefrontAccessToken,customShopDomains:d??r.customShopDomains,billing:h??r.billing,future:i??r.future}),r.isCustomStoreApp&&e.adminApiAccessToken===e.apiSecretKey&&eq(r).warning("adminApiAccessToken is set to the same value as apiSecretKey. adminApiAccessToken should be set to the Admin API access token for custom store apps; apiSecretKey should be set to the custom store app's API secret key."),r}({...r,future:e,restResources:t}),o={config:s,clients:{Rest:tC({config:s}),Graphql:tS({config:s}),Storefront:function(e){let{config:t}=e;class r extends tI{static config=t}return Reflect.defineProperty(r,"name",{value:"StorefrontClient"}),r}({config:s}),graphqlProxy:async({session:e,rawBody:t})=>{let r,n;if(!e.accessToken)throw new eO("Cannot proxy query. Session not authenticated.");let i=new(tS({config:s}))({session:e});if("string"==typeof t?r=t:(r=t.query,n=t.variables),!r)throw new ex("Query missing.");return{body:await i.request(r,{variables:n}),headers:{}}}},auth:{begin:async({shop:e,callbackPath:t,isOnline:r,...n})=>{r3(s.isCustomStoreApp,"Cannot perform OAuth for private apps");let i=eq(s);i.info("Beginning OAuth",{shop:e,isOnline:r,callbackPath:t});let o=await j(n),a=await q(n),c=o.headers["User-Agent"];if(Array.isArray(c)&&(c=c[0]),tR(c))return r5({request:o,log:i,func:"begin"}),a.statusCode=410,M(a,n);let l=new rZ(o,a,{keys:[s.apiSecretKey],secure:!0}),u=tB();await l.setAndSign(tX,u,{expires:new Date(Date.now()+6e4),sameSite:"lax",secure:!0,path:t});let p=s.scopes?s.scopes.toString():"",d={client_id:s.apiKey,scope:p,redirect_uri:`${s.hostScheme}://${s.hostName}${t}`,state:u,"grant_options[]":r?"per-user":""},h=new t_;h.putAll(d);let f=tK(s)(e,!0),m=`https://${f}/admin/oauth/authorize${h.stringify()}`;return a.statusCode=302,a.statusText="Found",a.headers={...a.headers,...l.response.headers,Location:m},i.debug(`OAuth started, redirecting to ${m}`,{shop:e,isOnline:r}),M(a,n)},callback:async function({...e}){r3(s.isCustomStoreApp,"Cannot perform OAuth for private apps");let t=eq(s),r=await j(e),n=new URL(r.url,`${s.hostScheme}://${s.hostName}`).searchParams,i=n.get("shop"),o=r.headers["User-Agent"];if(Array.isArray(o)&&(o=o[0]),tR(o))throw r5({request:r,log:t,func:"callback"}),new eP("Invalid OAuth callback initiated by bot");t.info("Completing OAuth",{shop:i});let a=new rZ(r,{},{keys:[s.apiSecretKey],secure:!0}),c=await a.getAndVerify(tX);if(a.deleteCookie(tX),!c)throw t.error("Could not find OAuth cookie",{shop:i}),new eI(`Cannot complete OAuth process. Could not find an OAuth cookie for shop url: ${i}`);let l=Object.fromEntries(n.entries());if(!await r4({config:s,query:l,stateFromCookie:c}))throw t.error("Invalid OAuth callback",{shop:i,stateFromCookie:c}),new e$("Invalid OAuth callback.");t.debug("OAuth request is valid, requesting access token",{shop:i});let u={client_id:s.apiKey,client_secret:s.apiSecretKey,code:n.get("code")},p=tK(s)(n.get("shop"),!0),d=await tW(s)(`https://${p}/admin/oauth/access_token`,{method:"POST",body:JSON.stringify(u),headers:{"Content-Type":k.JSON,Accept:k.JSON}});d.ok||tw(await d.json(),!1,d);let h=r2({accessTokenResponse:await d.json(),shop:p,state:c,config:s});return s.isEmbeddedApp||await a.setAndSign(tV,h.id,{expires:h.expires,sameSite:"lax",secure:!0,path:"/"}),{headers:await H(a.response.headers,e),session:h}},nonce:tB,safeCompare:tx,getEmbeddedAppUrl:async({...e})=>{let t=await j(e);if(!t)throw new ex("getEmbeddedAppUrl requires a request object argument");if(!t.url)throw new eU("Request does not contain a URL");let r=new URL(t.url,`https://${t.headers.host}`).searchParams.get("host");if("string"!=typeof r)throw new eU("Request does not contain a host query parameter");return r6(s)(r)},buildEmbeddedAppUrl:r6(s),tokenExchange:async({shop:e,sessionToken:t,requestedTokenType:r})=>{await rQ(s)(t);let n={client_id:s.apiKey,client_secret:s.apiSecretKey,grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:t,subject_token_type:"urn:ietf:params:oauth:token-type:id_token",requested_token_type:r},i=tK(s)(e,!0),o=await tW(s)(`https://${i}/admin/oauth/access_token`,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":k.JSON,Accept:k.JSON}});return o.ok||tw(await o.json(),!1,o),{session:r2({accessTokenResponse:await o.json(),shop:i,state:"",config:s})}},clientCredentials:async({shop:e})=>{let t=tK(s)(e,!0),r={method:"POST",body:JSON.stringify({client_id:s.apiKey,client_secret:s.apiSecretKey,grant_type:"client_credentials"}),headers:{"Content-Type":k.JSON,Accept:k.JSON}},n=await tW(s)(`https://${t}/admin/oauth/access_token`,r),i=await n.json();return n.ok||tw(i,!1,n),{session:r2({accessTokenResponse:i,shop:t,state:"",config:s})}}},session:{customAppSession:e=>new t1({id:"",shop:`${tK(s)(e,!0)}`,state:"",isOnline:!1}),getCurrentId:async function({isOnline:e,...t}){let r=await j(t),n=eq(s);if(!s.isEmbeddedApp)return n.debug("App is not embedded, looking for session id in cookies",{isOnline:e}),new rZ(r,{},{keys:[s.apiSecretKey]}).getAndVerify(tV);{n.debug("App is embedded, looking for session id in JWT payload",{isOnline:e});let t=r.headers.Authorization;if(t){let r=("string"==typeof t?t:t[0]).match(/^Bearer (.+)$/);if(!r)throw n.error("Missing Bearer token in authorization header",{isOnline:e}),new ey("Missing Bearer token in authorization header");let i=await rQ(s)(r[1]),o=i.dest.replace(/^https:\/\//,"");return(n.debug("Found valid JWT payload",{shop:o,isOnline:e}),e)?r0(s)(o,i.sub):r1(s)(o)}n.error("Missing Authorization header, was the request made with authenticatedFetch?",{isOnline:e})}},getOfflineId:r1(s),getJwtSessionId:r0(s),decodeSessionToken:rQ(s)},utils:{sanitizeShop:tK(s),sanitizeHost:tJ(),validateHmac:tD(s),versionCompatible:r8(s),versionPriorTo:(n=s,(e,t=n.apiVersion)=>!r8(n)(e,t)),shopAdminUrlToLegacyUrl:tH,legacyUrlToShopAdminUrl:tL},webhooks:function(e){let t={};return{addHandlers:function(r){for(let[n,s]of Object.entries(r)){let r=r7(n);if(Array.isArray(s))for(let n of s)nn(e,t,r,n);else nn(e,t,r,s)}},getTopicsAdded:function(){return Object.keys(t)},getHandlers:ne(t),register:async function({session:r}){let n=eq(e);n.info("Registering webhooks",{shop:r.shop});let s=Object.keys(t).reduce((e,t)=>(e[t]=[],e),{}),i=await ni(e,r);for(let o in n.debug(`Existing topics: [${Object.keys(i).join(", ")}]`,{shop:r.shop}),t)!Object.prototype.hasOwnProperty.call(t,o)||eu.includes(o)||(s[o]=await no({config:e,session:r,topic:o,existingHandlers:i[o]||[],handlers:ne(t)(o)}),delete i[o]);for(let t in i){if(!Object.prototype.hasOwnProperty.call(i,t))continue;let n=new(tS({config:e}))({session:r});s[t]=await nc({config:e,client:n,topic:t,handlers:i[t],operation:$.Delete})}return s},process:async function({context:r,rawBody:n,...s}){let o={statusCode:i.Ok,statusText:ng[i.Ok],headers:{}};await eq(e).info("Receiving webhook request");let a=await ny(e)({rawBody:n,...s}),c="Unknown error while handling webhook";if(a.valid){let s=await nw(e,t,a,n,r);o.statusCode=s.statusCode,D(o)||(c=s.errorMessage||c)}else{let t=await nb(e,a);o.statusCode=t.statusCode,o.statusText=ng[o.statusCode],c=t.errorMessage}let l=await M(o,s);if(!D(o))throw new eR({message:c,response:l});return Promise.resolve(l)},validate:ny(e)}}(s),billing:{check:async function(e){if(!s.future?.unstable_managedPricingSupport&&!s.billing)throw new eD({message:"Attempted to look for purchases without billing configs",errorData:[]});let{session:t,isTest:r=!0,plans:n}=e,i=e.returnObject??!1,o=new(tS({config:s}))({session:t}),a=await nk({client:o,isTest:r,plans:n});return s.future?.unstable_managedPricingSupport||i?a:a.hasActivePayment},request:async function({session:e,plan:t,isTest:r=!0,returnUrl:n,returnObject:i=!1,...o}){let a;if(!s.billing||!s.billing[t])throw new eD({message:`Could not find plan ${t} in billing settings`,errorData:[]});let c={...s.billing[t]},l=Object.fromEntries(Object.entries(o).filter(([e,t])=>void 0!==t)),u=e.shop.replace(".myshopify.com",""),p=r6(s)(function(e,t){let r=new TextEncoder().encode(e);switch(t){case f.Base64:return tk(r);case f.Hex:return tv(r);default:throw new ep(`Unrecognized hash format '${t}'`)}}(`admin.shopify.com/store/${u}`,f.Base64)),d=`${s.hostScheme}://${s.hostName}?shop=${e.shop}`,h=n||(s.isEmbeddedApp?p:d),m=new(tS({config:s}))({session:e});if("lineItems"in c){let e=function(e,t){let r={...e,...t},n=[];if(e.lineItems&&t.lineItems){for(let r of e.lineItems){let e=!1;for(let s of t.lineItems)if(r.interval===s.interval){n.push({...r,...s}),e=!0;break}e||n.push(r)}r.lineItems=n}return r}(c,l);a=(await nP({billingConfig:e,plan:t,client:m,returnUrl:h,isTest:r})).appSubscriptionCreate}else a=c.interval===b.OneTime?(await nR({billingConfig:{...c,...l},plan:t,client:m,returnUrl:h,isTest:r})).appPurchaseOneTimeCreate:c.interval===b.Usage?(await nO({billingConfig:{...c,...l},plan:t,client:m,returnUrl:h,isTest:r})).appSubscriptionCreate:(await nI({billingConfig:{...c,...l},plan:t,client:m,returnUrl:h,isTest:r})).appSubscriptionCreate;if(a.userErrors?.length)throw new eD({message:"Error while billing the store",errorData:a.userErrors});return i?a:a.confirmationUrl},cancel:async function(e){let{session:t,subscriptionId:r,prorate:n=!0}=e,i=new(tS({config:s}))({session:t});try{let e=await i.request(n_,{variables:{id:r,prorate:n}});if(e.data?.appSubscriptionCancel?.userErrors.length)throw new eD({message:"Error while canceling a subscription",errorData:e.data?.appSubscriptionCancel?.userErrors});return e.data?.appSubscriptionCancel?.appSubscription}catch(e){if(e instanceof eC)throw new eD({message:e.message,errorData:e.response?.errors});throw e}},subscriptions:async function({session:e}){if(!s.future?.unstable_managedPricingSupport&&!s.billing)throw new eD({message:"Attempted to look for purchases without billing configs",errorData:[]});let t=new(tS({config:s}))({session:e}),r=await t.request(nx);if(!r.data?.currentAppInstallation?.activeSubscriptions)return{activeSubscriptions:[]};let n=r.data.currentAppInstallation.activeSubscriptions;return n.forEach(e=>{e.lineItems&&(e.lineItems=nE(e.lineItems))}),{activeSubscriptions:n}},createUsageRecord:async function(e){let{session:t,subscriptionLineItemId:r,description:n,price:i,idempotencyKey:o,isTest:a=!0}=e,c=new(tS({config:s}))({session:t}),l={description:n,price:i,subscriptionLineItemId:r||await nD({client:c,isTest:a})};o&&(l.idempotencyKey=o);try{let e=await c.request(nU,{variables:l});if(e.data?.appUsageRecordCreate?.userErrors.length)throw new eD({message:"Error while creating a usage record",errorData:e.data?.appUsageRecordCreate?.userErrors});let t=e.data?.appUsageRecordCreate?.appUsageRecord;return nA(t.price),nv(t.subscriptionLineItem.plan.pricingDetails),t}catch(e){if(e instanceof eC)throw new eD({message:e.message,errorData:e.response?.errors});throw e}},updateUsageCappedAmount:async function(e){if(!s.billing)throw new eD({message:"Attempted to update line item without billing configs",errorData:[]});let{session:t,subscriptionLineItemId:r,cappedAmount:{amount:n,currencyCode:i}}=e,o=new(tS({config:s}))({session:t});try{let e=await o.request(nN,{variables:{id:r,cappedAmount:{amount:n,currencyCode:i}}});if(e.data?.appSubscriptionLineItemUpdate?.userErrors.length)throw new eD({message:"Error while updating usage subscription capped amount",errorData:e.data?.appSubscriptionLineItemUpdate?.userErrors});let t=e.data?.appSubscriptionLineItemUpdate?.appSubscription;return t&&t.lineItems&&(t.lineItems=nE(t.lineItems)),{confirmationUrl:e.data?.appSubscriptionLineItemUpdate?.confirmationUrl,appSubscription:t}}catch(e){if(e instanceof eC)throw new eD({message:e.message,errorData:e.response?.errors});throw e}}},flow:{validate:async function({rawBody:e,...t}){return tj(s)({type:E.Flow,rawBody:e,...t})}},fulfillmentService:{validate:async function({rawBody:e,...t}){return tj(s)({type:E.FulfillmentService,rawBody:e,...t})}},logger:eq(s),rest:{}};return t&&(o.rest=function({resources:e,config:t,RestClient:r}){let n=Object.keys(e)[0];return t.apiVersion!==e[n].apiVersion&&eq(t).warning(`Loading REST resources for API version ${e[n].apiVersion}, which doesn't match the default ${t.apiVersion}`),Object.fromEntries(Object.entries(e).map(([e,n])=>{class s extends n{}return s.setClassProperties({Client:r,config:t}),Object.entries(s.hasOne).map(([e,n])=>{n.setClassProperties({Client:r,config:t})}),Object.entries(s.hasMany).map(([e,n])=>{n.setClassProperties({Client:r,config:t})}),Reflect.defineProperty(s,"name",{value:e}),[e,s]}))}({resources:t,config:s,RestClient:tC({config:s})})),o.logger.info(`version ${ej}, environment ${L()}`).catch(e=>console.log(e)),function(e,t){if(!e._logDisabledFutureFlags)return;let r=(e,r)=>t.info(`Future flag ${e} is disabled.

  ${r}
`);e.future?.lineItemBilling||r("lineItemBilling","Enable this flag to use the new billing API, that supports multiple line items per plan."),e.future?.v10_lineItemBilling&&t.deprecated("12.0.0","v10_lineItemBilling will become enabled in v11. Use flag lineItemBilling instead"),e.future?.customerAddressDefaultFix||r("customerAddressDefaultFix","Enable this flag to change the CustomerAddress classes to expose a 'is_default' property instead of 'default' when fetching data."),e.future?.unstable_managedPricingSupport||r("unstable_managedPricingSupport","Enable this flag to support managed pricing, so apps can check for payments without needing a billing config. Learn more at https://shopify.dev/docs/apps/launch/billing/managed-pricing")}(s,o.logger),o}({apiKey:nq,apiSecretKey:nM,scopes:nH,apiVersion:el,hostName:new URL(nj).host,hostScheme:new URL(nj).protocol.replace(":",""),isEmbeddedApp:!1}),nF="nodejs",{SHOPIFY_API_KEY:nK,SHOPIFY_API_SECRET:nJ,SHOPIFY_SCOPES:nW,SHOPIFY_API_VERSION:nV,APP_URL:nX}=process.env,nB=(nX||"").replace(/\/+$/,""),nz=(nJ||"").replace(/\r?\n/g,"").trim(),nG=new Set(["hmac","signature","debug","check","dryrun","format"]);function nQ(e,t){return _.NextResponse.json(t,{status:e,headers:{"Cache-Control":"no-store"}})}function nY(e){return!!e&&/^[a-z0-9][a-z0-9-]*\.myshopify\.com$/i.test(e)}async function nZ(e){if(!nK||!nz||!nW||!nB)return nQ(500,{error:"Faltan variables de entorno",SHOPIFY_API_KEY:!!nK,SHOPIFY_API_SECRET:!!nz,SHOPIFY_SCOPES:!!nW,APP_URL:nB});let t=new URL(e.url),r=t.searchParams.get("shop")||e.cookies.get("shopify_shop")?.value||"",n=t.searchParams.get("code"),s=t.searchParams.get("check"),i=t.searchParams.get("dryrun"),o=t.searchParams.get("debug"),a=t.searchParams.get("format"),c=`${nB}/api/shopify/oauth`;if(!n&&"1"===s){let t=nY(r)?r:"",n=t?`https://${t}/admin/oauth/authorize?client_id=${encodeURIComponent(nK)}&scope=${encodeURIComponent(nW)}&redirect_uri=${encodeURIComponent(c)}&state=<RANDOM_STATE>`:"(agrega ?shop=tu-tienda.myshopify.com)";return nQ(200,{note:"Diagn\xf3stico: esto es lo que enviar\xedamos a Shopify (no se redirige)",app_url_env:nB,request_origin_deduced:`https://${e.headers.get("host")}`,redirect_uri_expected:c,redirect_uri_must_match_allowed:c,shop_input:r,shop_validated:t,example_authorize_url:n,tips:["Allowed redirection URL debe coincidir EXACTO con redirect_uri","SHOPIFY_API_SECRET = Client secret del app"]})}if(!n){if(!nY(r))return nQ(400,{error:"Par\xe1metro 'shop' inv\xe1lido. Ej: tu-tienda.myshopify.com",shop:r});if("1"===i){let e=U().randomBytes(24).toString("base64url"),t=`https://${r}/admin/oauth/authorize?client_id=${encodeURIComponent(nK)}&scope=${encodeURIComponent(nW)}&redirect_uri=${encodeURIComponent(c)}&state=${encodeURIComponent(e)}`;return new _.NextResponse(t,{status:200,headers:{"Content-Type":"text/plain; charset=utf-8","Cache-Control":"no-store"}})}return await nL.auth.begin({shop:r,isOnline:!1,callbackPath:"/api/shopify/oauth",request:e})}if("2"===o){let n=t.searchParams.get("hmac")||"",s=function(e){let t=Array.from(new Set(Array.from(e.searchParams.keys()))).filter(e=>!nG.has(e)).sort((e,t)=>e.localeCompare(t)),r=[];for(let n of t)for(let t of e.searchParams.getAll(n).sort((e,t)=>e.localeCompare(t)))r.push(`${n}=${t}`);return r.join("&")}(t),i=U().createHmac("sha256",nz).update(s,"utf8").digest("hex");return nQ(200,{note:"DEBUG2: inspecci\xf3n del callback (no se canjea el token)",full_url:e.url,shop:r,hmac:{given:n,expected:i,message_signed:s,match:function(e,t){let r=Buffer.from((e||"").toLowerCase(),"hex"),n=Buffer.from((t||"").toLowerCase(),"hex");return r.length===n.length&&U().timingSafeEqual(r,n)}(i,n)},redirect_uri_expected:c})}try{let{session:t,shop:r}=await nL.auth.callback({isOnline:!1,request:e}),n=t.accessToken,s=t.scope||"",i=nV||"2025-07";if("json"===a)return nQ(200,{ok:!0,shop:r,api_version:i,access_token:n,scope:s,saved_at:new Date().toISOString()});let o=`${n.slice(0,6)}${n.slice(-4)}`,c=JSON.stringify({access_token:n,scope:s,shop:r,api_version:i,saved_at:new Date().toISOString()},null,2);return new _.NextResponse(`<!doctype html><html><body style="font-family:system-ui;padding:28px">
        <h1> OAuth OK</h1>
        <p><b>Tienda:</b> ${r}</p>
        <p><b>Versi\xf3n API:</b> ${i}</p>
        <p><b>Scope:</b> ${s}</p>
        <p><b>Access token:</b> <span style="color:#0a7f3f">${o}</span></p>
        <p><a href="data:application/json;charset=utf-8,${encodeURIComponent(c)}" download="${r.replace(/\./g,"_")}.json">Descargar JSON</a></p>
        <p>Para pipelines, vuelve con <code>&format=json</code>.</p>
      </body></html>`,{headers:{"Content-Type":"text/html; charset=utf-8","Cache-Control":"no-store"}})}catch(e){return nQ(400,{error:"OAuth callback fall\xf3",details:String(e)})}}let n0=new I.AppRouteRouteModule({definition:{kind:O.x.APP_ROUTE,page:"/api/shopify/oauth/route",pathname:"/api/shopify/oauth",filename:"route",bundlePath:"app/api/shopify/oauth/route"},resolvedPagePath:"/Users/admin/Documents/ODDS/landing/lading-odds/app/api/shopify/oauth/route.ts",nextConfigOutput:"",userland:P}),{requestAsyncStorage:n1,staticGenerationAsyncStorage:n2,serverHooks:n5}=n0,n4="/api/shopify/oauth/route";function n3(){return(0,R.patchFetch)({serverHooks:n5,staticGenerationAsyncStorage:n2})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(5029));module.exports=n})();